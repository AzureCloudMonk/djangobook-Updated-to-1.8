<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chapter 12 - testing in Django &mdash; Mastering Django</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Mastering Django" href="index.html" />
    <link rel="next" title="Chapter 13: Deploying Django" href="chapter_13.html" />
    <link rel="prev" title="Chapter 11: User authentication in Django" href="chapter_11.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Mastering Django</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="chapter_11.html" title="Chapter 11: User authentication in Django"
             accesskey="P">previous</a> |
          <a href="chapter_13.html" title="Chapter 13: Deploying Django"
             accesskey="N">next</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="chapter-12-testing-in-django">
<h1>Chapter 12 - testing in Django<a class="headerlink" href="#chapter-12-testing-in-django" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introducing-automated-testing">
<h2>Introducing automated testing<a class="headerlink" href="#introducing-automated-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-are-automated-tests">
<h3>What are automated tests?<a class="headerlink" href="#what-are-automated-tests" title="Permalink to this headline">¶</a></h3>
<p>Tests are simple routines that check the operation of your code.</p>
<p>Testing operates at different levels. Some tests might apply to a tiny detail
(<em>does a particular model method return values as expected?</em>) while others
examine the overall operation of the software (<em>does a sequence of user inputs
on the site produce the desired result?</em>). That&#8217;s no different from the kind of
testing we did earlier in the book, using the
shell to examine the behavior of a method, or running the
application and entering data to check how it behaves.</p>
<p>What&#8217;s different in <em>automated</em> tests is that the testing work is done for
you by the system. You create a set of tests once, and then as you make changes
to your app, you can check that your code still works as you originally
intended, without having to perform time consuming manual testing.</p>
</div>
<div class="section" id="why-you-need-to-create-tests">
<h3>Why you need to create tests<a class="headerlink" href="#why-you-need-to-create-tests" title="Permalink to this headline">¶</a></h3>
<p>So why create tests, and why now?</p>
<p>You may feel that you have quite enough on your plate just learning
Python/Django, and having yet another thing to learn and do may seem
overwhelming and perhaps unnecessary. After all, our polls application is
working quite happily now; going through the trouble of creating automated
tests is not going to make it work any better. If creating the polls
application is the last bit of Django programming you will ever do, then true,
you don&#8217;t need to know how to create automated tests. But, if that&#8217;s not the
case, now is an excellent time to learn.</p>
<div class="section" id="tests-will-save-you-time">
<h4>Tests will save you time<a class="headerlink" href="#tests-will-save-you-time" title="Permalink to this headline">¶</a></h4>
<p>Up to a certain point, &#8216;checking that it seems to work&#8217; will be a satisfactory
test. In a more sophisticated application, you might have dozens of complex
interactions between components.</p>
<p>A change in any of those components could have unexpected consequences on the
application&#8217;s behavior. Checking that it still &#8216;seems to work&#8217; could mean
running through your code&#8217;s functionality with twenty different variations of
your test data just to make sure you haven&#8217;t broken something - not a good use
of your time.</p>
<p>That&#8217;s especially true when automated tests could do this for you in seconds.
If something&#8217;s gone wrong, tests will also assist in identifying the code
that&#8217;s causing the unexpected behavior.</p>
<p>Sometimes it may seem a chore to tear yourself away from your productive,
creative programming work to face the unglamorous and unexciting business
of writing tests, particularly when you know your code is working properly.</p>
<p>However, the task of writing tests is a lot more fulfilling than spending hours
testing your application manually or trying to identify the cause of a
newly-introduced problem.</p>
</div>
<div class="section" id="tests-don-t-just-identify-problems-they-prevent-them">
<h4>Tests don&#8217;t just identify problems, they prevent them<a class="headerlink" href="#tests-don-t-just-identify-problems-they-prevent-them" title="Permalink to this headline">¶</a></h4>
<p>It&#8217;s a mistake to think of tests merely as a negative aspect of development.</p>
<p>Without tests, the purpose or intended behavior of an application might be
rather opaque. Even when it&#8217;s your own code, you will sometimes find yourself
poking around in it trying to find out what exactly it&#8217;s doing.</p>
<p>Tests change that; they light up your code from the inside, and when something
goes wrong, they focus light on the part that has gone wrong - <em>even if you
hadn&#8217;t even realized it had gone wrong</em>.</p>
</div>
<div class="section" id="tests-make-your-code-more-attractive">
<h4>Tests make your code more attractive<a class="headerlink" href="#tests-make-your-code-more-attractive" title="Permalink to this headline">¶</a></h4>
<p>You might have created a brilliant piece of software, but you will find that
many other developers will simply refuse to look at it because it lacks tests;
without tests, they won&#8217;t trust it. Jacob Kaplan-Moss, one of Django&#8217;s
original developers, says &#8220;Code without tests is broken by design.&#8221;</p>
<p>That other developers want to see tests in your software before they take it
seriously is yet another reason for you to start writing tests.</p>
</div>
<div class="section" id="tests-help-teams-work-together">
<h4>Tests help teams work together<a class="headerlink" href="#tests-help-teams-work-together" title="Permalink to this headline">¶</a></h4>
<p>The previous points are written from the point of view of a single developer
maintaining an application. Complex applications will be maintained by teams.
Tests guarantee that colleagues don&#8217;t inadvertently break your code (and that
you don&#8217;t break theirs without knowing). If you want to make a living as a
Django programmer, you must be good at writing tests!</p>
</div>
</div>
</div>
<div class="section" id="basic-testing-strategies">
<h2>Basic testing strategies<a class="headerlink" href="#basic-testing-strategies" title="Permalink to this headline">¶</a></h2>
<p>There are many ways to approach writing tests.</p>
<p>Some programmers follow a discipline called &#8220;<a class="reference external" href="http://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a>&#8221;; they
actually write their tests before they write their code. This might seem
counter-intuitive, but in fact it&#8217;s similar to what most people will often do
anyway: they describe a problem, then create some code to solve it. Test-driven
development simply formalizes the problem in a Python test case.</p>
<p>More often, a newcomer to testing will create some code and later decide that
it should have some tests. Perhaps it would have been better to write some
tests earlier, but it&#8217;s never too late to get started.</p>
<p>Sometimes it&#8217;s difficult to figure out where to get started with writing tests.
If you have written several thousand lines of Python, choosing something to
test might not be easy. In such a case, it&#8217;s fruitful to write your first test
the next time you make a change, either when you add a new feature or fix a bug.</p>
</div>
<div class="section" id="writing-tests">
<h2>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h2>
<p>Django&#8217;s unit tests use a Python standard library module: <code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code>. This
module defines tests using a class-based approach.</p>
<p>Here is an example which subclasses from <code class="xref py py-class docutils literal"><span class="pre">django.test.TestCase</span></code>,
which is a subclass of <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code> that runs each test inside a
transaction to provide isolation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Animal</span>

<span class="k">class</span> <span class="nc">AnimalTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Animal</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;lion&quot;</span><span class="p">,</span> <span class="n">sound</span><span class="o">=</span><span class="s">&quot;roar&quot;</span><span class="p">)</span>
        <span class="n">Animal</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cat&quot;</span><span class="p">,</span> <span class="n">sound</span><span class="o">=</span><span class="s">&quot;meow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_animals_can_speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Animals that can speak are correctly identified&quot;&quot;&quot;</span>
        <span class="n">lion</span> <span class="o">=</span> <span class="n">Animal</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;lion&quot;</span><span class="p">)</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">Animal</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cat&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lion</span><span class="o">.</span><span class="n">speak</span><span class="p">(),</span> <span class="s">&#39;The lion says &quot;roar&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">speak</span><span class="p">(),</span> <span class="s">&#39;The cat says &quot;meow&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When you run your tests, the default behavior of the
test utility is to find all the test cases (that is, subclasses of
<code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code>) in any file whose name begins with <code class="docutils literal"><span class="pre">test</span></code>,
automatically build a test suite out of those test cases, and run that suite.</p>
<p>For more details about <code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code>, see the Python documentation.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If your tests rely on database access such as creating or querying models,
be sure to create your test classes as subclasses of
<code class="xref py py-class docutils literal"><span class="pre">django.test.TestCase</span></code> rather than <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code>.</p>
<p class="last">Using <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code> avoids the cost of running each test in a
transaction and flushing the database, but if your tests interact with
the database their behavior will vary based on the order that the test
runner executes them. This can lead to unit tests that pass when run in
isolation but fail when run in a suite.</p>
</div>
</div>
<div class="section" id="running-tests">
<span id="id1"></span><h2>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>Once you&#8217;ve written tests, run them using the test command of
your project&#8217;s <code class="docutils literal"><span class="pre">manage.py</span></code> utility:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./manage.py test
</pre></div>
</div>
<p>Test discovery is based on the unittest module&#8217;s built-in test
discovery.  By default, this will discover tests in
any file named &#8220;test*.py&#8221; under the current working directory.</p>
<p>You can specify particular tests to run by supplying any number of &#8220;test
labels&#8221; to <code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code>. Each test label can be a full Python dotted
path to a package, module, <code class="docutils literal"><span class="pre">TestCase</span></code> subclass, or test method. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre># Run all the tests in the animals.tests module
$ ./manage.py test animals.tests

# Run all the tests found within the &#39;animals&#39; package
$ ./manage.py test animals

# Run just one test case
$ ./manage.py test animals.tests.AnimalTestCase

# Run just one test method
$ ./manage.py test animals.tests.AnimalTestCase.test_animals_can_speak
</pre></div>
</div>
<p>You can also provide a path to a directory to discover tests below that
directory:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./manage.py test animals/
</pre></div>
</div>
<p>You can specify a custom filename pattern match using the <code class="docutils literal"><span class="pre">-p</span></code> (or
<code class="docutils literal"><span class="pre">--pattern</span></code>) option, if your test files are named differently from the
<code class="docutils literal"><span class="pre">test*.py</span></code> pattern:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./manage.py test --pattern=&quot;tests_*.py&quot;
</pre></div>
</div>
<p>If you press <code class="docutils literal"><span class="pre">Ctrl-C</span></code> while the tests are running, the test runner will
wait for the currently running test to complete and then exit gracefully.
During a graceful exit the test runner will output details of any test
failures, report on how many tests were run and how many errors and failures
were encountered, and destroy any test databases as usual. Thus pressing
<code class="docutils literal"><span class="pre">Ctrl-C</span></code> can be very useful if you forget to pass the <code class="docutils literal"><span class="pre">--failfast</span></code>
option, notice that some tests are unexpectedly failing, and want to get details
on the failures without waiting for the full test run to complete.</p>
<p>If you do not want to wait for the currently running test to finish, you
can press <code class="docutils literal"><span class="pre">Ctrl-C</span></code> a second time and the test run will halt immediately,
but not gracefully. No details of the tests run before the interruption will
be reported, and any test databases created by the run will not be destroyed.</p>
<div class="admonition-test-with-warnings-enabled admonition">
<p class="first admonition-title">Test with warnings enabled</p>
<p class="last">It&#8217;s a good idea to run your tests with Python warnings enabled:
<code class="docutils literal"><span class="pre">python</span> <span class="pre">-Wall</span> <span class="pre">manage.py</span> <span class="pre">test</span></code>. The <code class="docutils literal"><span class="pre">-Wall</span></code> flag tells Python to
display deprecation warnings. Django, like many other Python libraries,
uses these warnings to flag when features are going away. It also might
flag areas in your code that aren&#8217;t strictly wrong but could benefit
from a better implementation.</p>
</div>
<div class="section" id="the-test-database">
<span id="id2"></span><h3>The test database<a class="headerlink" href="#the-test-database" title="Permalink to this headline">¶</a></h3>
<p>Tests that require a database (namely, model tests) will not use your &#8220;real&#8221;
(production) database. Separate, blank databases are created for the tests.</p>
<p>Regardless of whether the tests pass or fail, the test databases are destroyed
when all the tests have been executed.</p>
<p>You can prevent the test databases from being destroyed by adding the
<code class="docutils literal"><span class="pre">--keepdb</span></code> flag to the test command. This will preserve the test
database between runs. If the database does not exist, it will first
be created. Any migrations will also be applied in order to keep it
up to date.</p>
<p>By default the test databases get their names by prepending <code class="docutils literal"><span class="pre">test_</span></code>
to the value of the <code class="docutils literal"><span class="pre">NAME</span></code> settings for the databases
defined in <code class="docutils literal"><span class="pre">DATABASES</span></code>. When using the SQLite database engine
the tests will by default use an in-memory database (i.e., the
database will be created in memory, bypassing the filesystem
entirely!). If you want to use a different database name, specify
<code class="docutils literal"><span class="pre">NAME</span> <span class="pre">&lt;TEST_NAME&gt;</span></code> in the <code class="docutils literal"><span class="pre">TEST</span> <span class="pre">&lt;DATABASE-TEST&gt;</span></code>
dictionary for any given database in <code class="docutils literal"><span class="pre">DATABASES</span></code>.</p>
<p>On PostgreSQL, <code class="docutils literal"><span class="pre">USER</span></code> will also need read access to the built-in
<code class="docutils literal"><span class="pre">postgres</span></code> database.</p>
<p>Aside from using a separate database, the test runner will otherwise
use all of the same database settings you have in your settings file:
<code class="docutils literal"><span class="pre">ENGINE</span> <span class="pre">&lt;DATABASE-ENGINE&gt;</span></code>, <code class="docutils literal"><span class="pre">USER</span></code>, <code class="docutils literal"><span class="pre">HOST</span></code>, etc. The
test database is created by the user specified by <code class="docutils literal"><span class="pre">USER</span></code>, so you&#8217;ll
need to make sure that the given user account has sufficient privileges to
create a new database on the system.</p>
<p>For fine-grained control over the character encoding of your test
database, use the <code class="docutils literal"><span class="pre">CHARSET</span> <span class="pre">&lt;TEST_CHARSET&gt;</span></code> TEST option. If you&#8217;re using
MySQL, you can also use the <code class="docutils literal"><span class="pre">COLLATION</span> <span class="pre">&lt;TEST_COLLATION&gt;</span></code> option to
control the particular collation used by the test database. See the
settings documentation  for details of these
and other advanced settings.</p>
<p>If using a SQLite in-memory database with Python 3.4+ and SQLite 3.7.13+,
<a class="reference external" href="https://www.sqlite.org/sharedcache.html">shared cache</a> will be enabled, so
you can write tests with ability to share the database between threads.</p>
<div class="admonition-finding-data-from-your-production-database-when-running-tests admonition">
<p class="first admonition-title">Finding data from your production database when running tests?</p>
<p>If your code attempts to access the database when its modules are compiled,
this will occur <em>before</em> the test database is set up, with potentially
unexpected results. For example, if you have a database query in
module-level code and a real database exists, production data could pollute
your tests. <em>It is a bad idea to have such import-time database queries in
your code</em> anyway - rewrite your code so that it doesn&#8217;t do this.</p>
<p class="last">This also applies to customized implementations of
<code class="xref py py-meth docutils literal"><span class="pre">ready()</span></code>.</p>
</div>
</div>
<div class="section" id="order-in-which-tests-are-executed">
<span id="order-of-tests"></span><h3>Order in which tests are executed<a class="headerlink" href="#order-in-which-tests-are-executed" title="Permalink to this headline">¶</a></h3>
<p>In order to guarantee that all <code class="docutils literal"><span class="pre">TestCase</span></code> code starts with a clean database,
the Django test runner reorders tests in the following way:</p>
<ul class="simple">
<li>All <code class="xref py py-class docutils literal"><span class="pre">TestCase</span></code> subclasses are run first.</li>
<li>Then, all other Django-based tests (test cases based on
<code class="xref py py-class docutils literal"><span class="pre">SimpleTestCase</span></code>, including
<code class="xref py py-class docutils literal"><span class="pre">TransactionTestCase</span></code>) are run with no particular
ordering guaranteed nor enforced among them.</li>
<li>Then any other <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code> tests (including doctests) that may
alter the database without restoring it to its original state are run.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The new ordering of tests may reveal unexpected dependencies on test case
ordering. This is the case with doctests that relied on state left in the
database by a given <code class="xref py py-class docutils literal"><span class="pre">TransactionTestCase</span></code> test, they
must be updated to be able to run independently.</p>
<p class="last">You may reverse the execution order inside groups by passing
<code class="docutils literal"><span class="pre">--reverse</span></code> to the test command. This can help with ensuring
your tests are independent from each other.</p>
</div>
</div>
<div class="section" id="rollback-emulation">
<span id="test-case-serialized-rollback"></span><h3>Rollback emulation<a class="headerlink" href="#rollback-emulation" title="Permalink to this headline">¶</a></h3>
<p>Any initial data loaded in migrations will only be available in <code class="docutils literal"><span class="pre">TestCase</span></code>
tests and not in <code class="docutils literal"><span class="pre">TransactionTestCase</span></code> tests, and additionally only on
backends where transactions are supported (the most important exception being
MyISAM). This is also true for tests which rely on <code class="docutils literal"><span class="pre">TransactionTestCase</span></code>
such as <a class="reference internal" href="#LiveServerTestCase" title="LiveServerTestCase"><code class="xref py py-class docutils literal"><span class="pre">LiveServerTestCase</span></code></a> and
<code class="xref py py-class docutils literal"><span class="pre">StaticLiveServerTestCase</span></code>.</p>
<p>Django can reload that data for you on a per-testcase basis by
setting the <code class="docutils literal"><span class="pre">serialized_rollback</span></code> option to <code class="docutils literal"><span class="pre">True</span></code> in the body of the
<code class="docutils literal"><span class="pre">TestCase</span></code> or <code class="docutils literal"><span class="pre">TransactionTestCase</span></code>, but note that this will slow down
that test suite by approximately 3x.</p>
<p>Third-party apps or those developing against MyISAM will need to set this;
in general, however, you should be developing your own projects against a
transactional database and be using <code class="docutils literal"><span class="pre">TestCase</span></code> for most tests, and thus
not need this setting.</p>
<p>The initial serialization is usually very quick, but if you wish to exclude
some apps from this process (and speed up test runs slightly), you may add
those apps to <code class="docutils literal"><span class="pre">TEST_NON_SERIALIZED_APPS</span></code>.</p>
</div>
<div class="section" id="other-test-conditions">
<h3>Other test conditions<a class="headerlink" href="#other-test-conditions" title="Permalink to this headline">¶</a></h3>
<p>Regardless of the value of the <code class="docutils literal"><span class="pre">DEBUG</span></code> setting in your configuration
file, all Django tests run with <code class="docutils literal"><span class="pre">DEBUG</span></code>=False. This is to ensure that
the observed output of your code matches what will be seen in a production
setting.</p>
<p>Caches are not cleared after each test, and running &#8220;manage.py test fooapp&#8221; can
insert data from the tests into the cache of a live system if you run your
tests in production because, unlike databases, a separate &#8220;test cache&#8221; is not
used. This behavior <a class="reference external" href="https://code.djangoproject.com/ticket/11505">may change</a> in the future.</p>
</div>
<div class="section" id="understanding-the-test-output">
<h3>Understanding the test output<a class="headerlink" href="#understanding-the-test-output" title="Permalink to this headline">¶</a></h3>
<p>When you run your tests, you&#8217;ll see a number of messages as the test runner
prepares itself. You can control the level of detail of these messages with the
<code class="docutils literal"><span class="pre">verbosity</span></code> option on the command line:</p>
<div class="highlight-python"><div class="highlight"><pre>Creating test database...
Creating table myapp_animal
Creating table myapp_mineral
</pre></div>
</div>
<p>This tells you that the test runner is creating a test database, as described
in the previous section.</p>
<p>Once the test database has been created, Django will run your tests.
If everything goes well, you&#8217;ll see something like this:</p>
<div class="highlight-python"><div class="highlight"><pre>----------------------------------------------------------------------
Ran 22 tests in 0.221s

OK
</pre></div>
</div>
<p>If there are test failures, however, you&#8217;ll see full details about which tests
failed:</p>
<div class="highlight-python"><div class="highlight"><pre>======================================================================
FAIL: test_was_published_recently_with_future_poll (polls.tests.PollMethodTests)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/dev/mysite/polls/tests.py&quot;, line 16, in test_was_published_recently_with_future_poll
    self.assertEqual(future_poll.was_published_recently(), False)
AssertionError: True != False

----------------------------------------------------------------------
Ran 1 test in 0.003s

FAILED (failures=1)
</pre></div>
</div>
<p>A full explanation of this error output is beyond the scope of this document,
but it&#8217;s pretty intuitive. You can consult the documentation of Python&#8217;s
<code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code> library for details.</p>
<p>Note that the return code for the test-runner script is 1 for any number of
failed and erroneous tests. If all the tests pass, the return code is 0. This
feature is useful if you&#8217;re using the test-runner script in a shell script and
need to test for success or failure at that level.</p>
</div>
<div class="section" id="speeding-up-the-tests">
<h3>Speeding up the tests<a class="headerlink" href="#speeding-up-the-tests" title="Permalink to this headline">¶</a></h3>
<p>In recent versions of Django, the default password hasher is rather slow by
design. If during your tests you are authenticating many users, you may want
to use a custom settings file and set the <code class="docutils literal"><span class="pre">PASSWORD_HASHERS</span></code> setting
to a faster hashing algorithm:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;django.contrib.auth.hashers.MD5PasswordHasher&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Don&#8217;t forget to also include in <code class="docutils literal"><span class="pre">PASSWORD_HASHERS</span></code> any hashing
algorithm used in fixtures, if any.</p>
</div>
</div>
<div class="section" id="testing-tools">
<h2>Testing tools<a class="headerlink" href="#testing-tools" title="Permalink to this headline">¶</a></h2>
<p>Django provides a small set of tools that come in handy when writing tests.</p>
<div class="section" id="the-test-client">
<span id="test-client"></span><h3>The test client<a class="headerlink" href="#the-test-client" title="Permalink to this headline">¶</a></h3>
<p>The test client is a Python class that acts as a dummy Web browser, allowing
you to test your views and interact with your Django-powered application
programmatically.</p>
<p>Some of the things you can do with the test client are:</p>
<ul class="simple">
<li>Simulate GET and POST requests on a URL and observe the response &#8211;
everything from low-level HTTP (result headers and status codes) to
page content.</li>
<li>See the chain of redirects (if any) and check the URL and status code at
each step.</li>
<li>Test that a given request is rendered by a given Django template, with
a template context that contains certain values.</li>
</ul>
<p>Note that the test client is not intended to be a replacement for <a class="reference external" href="http://seleniumhq.org/">Selenium</a> or
other &#8220;in-browser&#8221; frameworks. Django&#8217;s test client has a different focus. In
short:</p>
<ul class="simple">
<li>Use Django&#8217;s test client to establish that the correct template is being
rendered and that the template is passed the correct context data.</li>
<li>Use in-browser frameworks like <a class="reference external" href="http://seleniumhq.org/">Selenium</a> to test <em>rendered</em> HTML and the
<em>behavior</em> of Web pages, namely JavaScript functionality. Django also
provides special support for those frameworks; see the section on
<code class="xref py py-class docutils literal"><span class="pre">LiveServerTestCase</span></code> for more details.</li>
</ul>
<p>A comprehensive test suite should use a combination of both test types.</p>
<div class="section" id="overview-and-a-quick-example">
<h4>Overview and a quick example<a class="headerlink" href="#overview-and-a-quick-example" title="Permalink to this headline">¶</a></h4>
<p>To use the test client, instantiate <code class="docutils literal"><span class="pre">django.test.Client</span></code> and retrieve
Web pages:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/login/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;john&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;smith&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<span class="go">200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/details/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">content</span>
<span class="go">&#39;&lt;!DOCTYPE html...&#39;</span>
</pre></div>
</div>
<p>As this example suggests, you can instantiate <code class="docutils literal"><span class="pre">Client</span></code> from within a session
of the Python interactive interpreter.</p>
<p>Note a few important things about how the test client works:</p>
<ul>
<li><p class="first">The test client does <em>not</em> require the Web server to be running. In fact,
it will run just fine with no Web server running at all! That&#8217;s because
it avoids the overhead of HTTP and deals directly with the Django
framework. This helps make the unit tests run quickly.</p>
</li>
<li><p class="first">When retrieving pages, remember to specify the <em>path</em> of the URL, not the
whole domain. For example, this is correct:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is incorrect:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http://www.example.com/login/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The test client is not capable of retrieving Web pages that are not
powered by your Django project. If you need to retrieve other Web pages,
use a Python standard library module such as <code class="xref py py-mod docutils literal"><span class="pre">urllib</span></code>.</p>
</li>
<li><p class="first">To resolve URLs, the test client uses whatever URLconf is pointed-to by
your <code class="docutils literal"><span class="pre">ROOT_URLCONF</span></code> setting.</p>
</li>
<li><p class="first">Although the above example would work in the Python interactive
interpreter, some of the test client&#8217;s functionality, notably the
template-related functionality, is only available <em>while tests are
running</em>.</p>
<p>The reason for this is that Django&#8217;s test runner performs a bit of black
magic in order to determine which template was loaded by a given view.
This black magic (essentially a patching of Django&#8217;s template system in
memory) only happens during test running.</p>
</li>
<li><p class="first">By default, the test client will disable any CSRF checks
performed by your site.</p>
<p>If, for some reason, you <em>want</em> the test client to perform CSRF
checks, you can create an instance of the test client that
enforces CSRF checks. To do this, pass in the
<code class="docutils literal"><span class="pre">enforce_csrf_checks</span></code> argument when you construct your
client:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csrf_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">enforce_csrf_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="making-requests">
<h4>Making requests<a class="headerlink" href="#making-requests" title="Permalink to this headline">¶</a></h4>
<p>Use the <code class="docutils literal"><span class="pre">django.test.Client</span></code> class to make requests.</p>
<dl class="class">
<dt id="Client">
<em class="property">class </em><code class="descname">Client</code><span class="sig-paren">(</span><em>enforce_csrf_checks=False</em>, <em>**defaults</em><span class="sig-paren">)</span><a class="headerlink" href="#Client" title="Permalink to this definition">¶</a></dt>
<dd><p>It requires no arguments at time of construction. However, you can use
keywords arguments to specify some default headers. For example, this will
send a <code class="docutils literal"><span class="pre">User-Agent</span></code> HTTP header in each request:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">HTTP_USER_AGENT</span><span class="o">=</span><span class="s">&#39;Mozilla/5.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The values from the <code class="docutils literal"><span class="pre">extra</span></code> keywords arguments passed to
<code class="xref py py-meth docutils literal"><span class="pre">get()</span></code>,
<code class="xref py py-meth docutils literal"><span class="pre">post()</span></code>, etc. have precedence over
the defaults passed to the class constructor.</p>
<p>The <code class="docutils literal"><span class="pre">enforce_csrf_checks</span></code> argument can be used to test CSRF
protection (see above).</p>
<p>Once you have a <code class="docutils literal"><span class="pre">Client</span></code> instance, you can call any of the following
methods:</p>
<dl class="method">
<dt id="Client.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>path</em>, <em>data=None</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a GET request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a <code class="docutils literal"><span class="pre">Response</span></code>
object, which is documented below.</p>
<p>The key-value pairs in the <code class="docutils literal"><span class="pre">data</span></code> dictionary are used to create a GET
data payload. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customers/details/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">})</span>
</pre></div>
</div>
<p>...will result in the evaluation of a GET request equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre>/customers/details/?name=fred&amp;age=7
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">extra</span></code> keyword arguments parameter can be used to specify
headers to be sent in the request. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customers/details/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span>
<span class="gp">... </span>      <span class="n">HTTP_X_REQUESTED_WITH</span><span class="o">=</span><span class="s">&#39;XMLHttpRequest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>...will send the HTTP header <code class="docutils literal"><span class="pre">HTTP_X_REQUESTED_WITH</span></code> to the
details view, which is a good way to test code paths that use the
<code class="xref py py-meth docutils literal"><span class="pre">django.http.HttpRequest.is_ajax()</span></code> method.</p>
<div class="admonition-cgi-specification admonition">
<p class="first admonition-title">CGI specification</p>
<p class="last">The headers sent via <code class="docutils literal"><span class="pre">**extra</span></code> should follow <a class="reference external" href="http://www.w3.org/CGI/">CGI</a> specification.
For example, emulating a different &#8220;Host&#8221; header as sent in the
HTTP request from the browser to the server should be passed
as <code class="docutils literal"><span class="pre">HTTP_HOST</span></code>.</p>
</div>
<p>If you already have the GET arguments in URL-encoded form, you can
use that encoding instead of using the data argument. For example,
the previous GET request could also be posed as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customers/details/?name=fred&amp;age=7&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you provide a URL with both an encoded GET data and a data argument,
the data argument will take precedence.</p>
<p>If you set <code class="docutils literal"><span class="pre">follow</span></code> to <code class="docutils literal"><span class="pre">True</span></code> the client will follow any redirects
and a <code class="docutils literal"><span class="pre">redirect_chain</span></code> attribute will be set in the response object
containing tuples of the intermediate urls and status codes.</p>
<p>If you had a URL <code class="docutils literal"><span class="pre">/redirect_me/</span></code> that redirected to <code class="docutils literal"><span class="pre">/next/</span></code>, that
redirected to <code class="docutils literal"><span class="pre">/final/</span></code>, this is what you&#8217;d see:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/redirect_me/&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">redirect_chain</span>
<span class="go">[(&#39;http://testserver/next/&#39;, 302), (&#39;http://testserver/final/&#39;, 302)]</span>
</pre></div>
</div>
<p>If you set <code class="docutils literal"><span class="pre">secure</span></code> to <code class="docutils literal"><span class="pre">True</span></code> the client will emulate an HTTPS
request.</p>
</dd></dl>

<dl class="method">
<dt id="Client.post">
<code class="descname">post</code><span class="sig-paren">(</span><em>path</em>, <em>data=None</em>, <em>content_type=MULTIPART_CONTENT</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.post" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a POST request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object, which is documented below.</p>
<p>The key-value pairs in the <code class="docutils literal"><span class="pre">data</span></code> dictionary are used to submit POST
data. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/login/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="s">&#39;passwd&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>...will result in the evaluation of a POST request to this URL:</p>
<div class="highlight-python"><div class="highlight"><pre>/login/
</pre></div>
</div>
<p>...with this POST data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">name</span><span class="o">=</span><span class="n">fred</span><span class="o">&amp;</span><span class="n">passwd</span><span class="o">=</span><span class="n">secret</span>
</pre></div>
</div>
<p>If you provide <code class="docutils literal"><span class="pre">content_type</span></code> (e.g. <em class="mimetype">text/xml</em> for an XML
payload), the contents of <code class="docutils literal"><span class="pre">data</span></code> will be sent as-is in the POST
request, using <code class="docutils literal"><span class="pre">content_type</span></code> in the HTTP <code class="docutils literal"><span class="pre">Content-Type</span></code> header.</p>
<p>If you don&#8217;t provide a value for <code class="docutils literal"><span class="pre">content_type</span></code>, the values in
<code class="docutils literal"><span class="pre">data</span></code> will be transmitted with a content type of
<em class="mimetype">multipart/form-data</em>. In this case, the key-value pairs in
<code class="docutils literal"><span class="pre">data</span></code> will be encoded as a multipart message and used to create the
POST data payload.</p>
<p>To submit multiple values for a given key &#8211; for example, to specify
the selections for a <code class="docutils literal"><span class="pre">&lt;select</span> <span class="pre">multiple&gt;</span></code> &#8211; provide the values as a
list or tuple for the required key. For example, this value of <code class="docutils literal"><span class="pre">data</span></code>
would submit three selected values for the field named <code class="docutils literal"><span class="pre">choices</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;choices&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Submitting files is a special case. To POST a file, you need only
provide the file field name as a key, and a file handle to the file you
wish to upload as a value. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;wishlist.doc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/customers/wishes/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">:</span> <span class="n">fp</span><span class="p">})</span>
</pre></div>
</div>
<p>(The name <code class="docutils literal"><span class="pre">attachment</span></code> here is not relevant; use whatever name your
file-processing code expects.)</p>
<p>You may also provide any file-like object (e.g., <code class="xref py py-class docutils literal"><span class="pre">StringIO</span></code> or
<code class="xref py py-class docutils literal"><span class="pre">BytesIO</span></code>) as a file handle.</p>
<p>Note that if you wish to use the same file handle for multiple
<code class="docutils literal"><span class="pre">post()</span></code> calls then you will need to manually reset the file
pointer between posts. The easiest way to do this is to
manually close the file after it has been provided to
<code class="docutils literal"><span class="pre">post()</span></code>, as demonstrated above.</p>
<p>You should also ensure that the file is opened in a way that
allows the data to be read. If your file contains binary data
such as an image, this means you will need to open the file in
<code class="docutils literal"><span class="pre">rb</span></code> (read binary) mode.</p>
<p>The <code class="docutils literal"><span class="pre">extra</span></code> argument acts the same as for <a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>.</p>
<p>If the URL you request with a POST contains encoded parameters, these
parameters will be made available in the request.GET data. For example,
if you were to make the request:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/login/?visitor=true&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="s">&#39;passwd&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>... the view handling this request could interrogate request.POST
to retrieve the username and password, and could interrogate request.GET
to determine if the user was a visitor.</p>
<p>If you set <code class="docutils literal"><span class="pre">follow</span></code> to <code class="docutils literal"><span class="pre">True</span></code> the client will follow any redirects
and a <code class="docutils literal"><span class="pre">redirect_chain</span></code> attribute will be set in the response object
containing tuples of the intermediate urls and status codes.</p>
<p>If you set <code class="docutils literal"><span class="pre">secure</span></code> to <code class="docutils literal"><span class="pre">True</span></code> the client will emulate an HTTPS
request.</p>
</dd></dl>

<dl class="method">
<dt id="Client.head">
<code class="descname">head</code><span class="sig-paren">(</span><em>path</em>, <em>data=None</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.head" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a HEAD request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object. This method works just like <a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>,
including the <code class="docutils literal"><span class="pre">follow</span></code>, <code class="docutils literal"><span class="pre">secure</span></code> and <code class="docutils literal"><span class="pre">extra</span></code> arguments, except
it does not return a message body.</p>
</dd></dl>

<dl class="method">
<dt id="Client.options">
<code class="descname">options</code><span class="sig-paren">(</span><em>path</em>, <em>data=''</em>, <em>content_type='application/octet-stream'</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.options" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes an OPTIONS request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object. Useful for testing RESTful interfaces.</p>
<p>When <code class="docutils literal"><span class="pre">data</span></code> is provided, it is used as the request body, and
a <code class="docutils literal"><span class="pre">Content-Type</span></code> header is set to <code class="docutils literal"><span class="pre">content_type</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">follow</span></code>, <code class="docutils literal"><span class="pre">secure</span></code> and <code class="docutils literal"><span class="pre">extra</span></code> arguments act the same as for
<a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="Client.put">
<code class="descname">put</code><span class="sig-paren">(</span><em>path</em>, <em>data=''</em>, <em>content_type='application/octet-stream'</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a PUT request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object. Useful for testing RESTful interfaces.</p>
<p>When <code class="docutils literal"><span class="pre">data</span></code> is provided, it is used as the request body, and
a <code class="docutils literal"><span class="pre">Content-Type</span></code> header is set to <code class="docutils literal"><span class="pre">content_type</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">follow</span></code>, <code class="docutils literal"><span class="pre">secure</span></code> and <code class="docutils literal"><span class="pre">extra</span></code> arguments act the same as for
<a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="Client.patch">
<code class="descname">patch</code><span class="sig-paren">(</span><em>path</em>, <em>data=''</em>, <em>content_type='application/octet-stream'</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.patch" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a PATCH request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object. Useful for testing RESTful interfaces.</p>
<p>The <code class="docutils literal"><span class="pre">follow</span></code>, <code class="docutils literal"><span class="pre">secure</span></code> and <code class="docutils literal"><span class="pre">extra</span></code> arguments act the same as for
<a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="Client.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>path</em>, <em>data=''</em>, <em>content_type='application/octet-stream'</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes an DELETE request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object. Useful for testing RESTful interfaces.</p>
<p>When <code class="docutils literal"><span class="pre">data</span></code> is provided, it is used as the request body, and
a <code class="docutils literal"><span class="pre">Content-Type</span></code> header is set to <code class="docutils literal"><span class="pre">content_type</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">follow</span></code>, <code class="docutils literal"><span class="pre">secure</span></code> and <code class="docutils literal"><span class="pre">extra</span></code> arguments act the same as for
<a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="Client.trace">
<code class="descname">trace</code><span class="sig-paren">(</span><em>path</em>, <em>follow=False</em>, <em>secure=False</em>, <em>**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a TRACE request on the provided <code class="docutils literal"><span class="pre">path</span></code> and returns a
<code class="docutils literal"><span class="pre">Response</span></code> object. Useful for simulating diagnostic probes.</p>
<p>Unlike the other request methods, <code class="docutils literal"><span class="pre">data</span></code> is not provided as a keyword
parameter in order to comply with <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a>, which mandates that
TRACE requests should not have an entity-body.</p>
<p>The <code class="docutils literal"><span class="pre">follow</span></code>, <code class="docutils literal"><span class="pre">secure</span></code>, and <code class="docutils literal"><span class="pre">extra</span></code> arguments act the same as for
<a class="reference internal" href="#Client.get" title="Client.get"><code class="xref py py-meth docutils literal"><span class="pre">Client.get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="Client.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>**credentials</em><span class="sig-paren">)</span><a class="headerlink" href="#Client.login" title="Permalink to this definition">¶</a></dt>
<dd><p>If your site uses Django&#8217;s authentication system
and you deal with logging in users, you can use the test client&#8217;s
<code class="docutils literal"><span class="pre">login()</span></code> method to simulate the effect of a user logging into the
site.</p>
<p>After you call this method, the test client will have all the cookies
and session data required to pass any login-based tests that may form
part of a view.</p>
<p>The format of the <code class="docutils literal"><span class="pre">credentials</span></code> argument depends on which
authentication backend you&#8217;re using
(which is configured by your <code class="docutils literal"><span class="pre">AUTHENTICATION_BACKENDS</span></code>
setting). If you&#8217;re using the standard authentication backend provided
by Django (<code class="docutils literal"><span class="pre">ModelBackend</span></code>), <code class="docutils literal"><span class="pre">credentials</span></code> should be the user&#8217;s
username and password, provided as keyword arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

<span class="go"># Now you can access a view that&#39;s only available to logged-in users.</span>
</pre></div>
</div>
<p>If you&#8217;re using a different authentication backend, this method may
require different credentials. It requires whichever credentials are
required by your backend&#8217;s <code class="docutils literal"><span class="pre">authenticate()</span></code> method.</p>
<p><code class="docutils literal"><span class="pre">login()</span></code> returns <code class="docutils literal"><span class="pre">True</span></code> if it the credentials were accepted and
login was successful.</p>
<p>Finally, you&#8217;ll need to remember to create user accounts before you can
use this method. As we explained above, the test runner is executed
using a test database, which contains no users by default. As a result,
user accounts that are valid on your production site will not work
under test conditions. You&#8217;ll need to create users as part of the test
suite &#8211; either manually (using the Django model API) or with a test
fixture. Remember that if you want your test user to have a password,
you can&#8217;t set the user&#8217;s password by setting the password attribute
directly &#8211; you must use the
<code class="xref py py-meth docutils literal"><span class="pre">set_password()</span></code> function to
store a correctly hashed password. Alternatively, you can use the
<code class="xref py py-meth docutils literal"><span class="pre">create_user()</span></code> helper
method to create a new user with a correctly hashed password.</p>
</dd></dl>

<dl class="method">
<dt id="Client.logout">
<code class="descname">logout</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Client.logout" title="Permalink to this definition">¶</a></dt>
<dd><p>If your site uses Django&#8217;s authentication system,
the <code class="docutils literal"><span class="pre">logout()</span></code> method can be used to simulate the effect of a user
logging out of your site.</p>
<p>After you call this method, the test client will have all the cookies
and session data cleared to defaults. Subsequent requests will appear
to come from an <code class="xref py py-class docutils literal"><span class="pre">AnonymousUser</span></code>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="testing-responses">
<h4>Testing responses<a class="headerlink" href="#testing-responses" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">get()</span></code> and <code class="docutils literal"><span class="pre">post()</span></code> methods both return a <code class="docutils literal"><span class="pre">Response</span></code> object. This
<code class="docutils literal"><span class="pre">Response</span></code> object is <em>not</em> the same as the <code class="docutils literal"><span class="pre">HttpResponse</span></code> object returned
by Django views; the test response object has some additional data useful for
test code to verify.</p>
<p>Specifically, a <code class="docutils literal"><span class="pre">Response</span></code> object has the following attributes:</p>
<dl class="class">
<dt id="Response">
<em class="property">class </em><code class="descname">Response</code><a class="headerlink" href="#Response" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="Response.client">
<code class="descname">client</code><a class="headerlink" href="#Response.client" title="Permalink to this definition">¶</a></dt>
<dd><p>The test client that was used to make the request that resulted in the
response.</p>
</dd></dl>

<dl class="attribute">
<dt id="Response.content">
<code class="descname">content</code><a class="headerlink" href="#Response.content" title="Permalink to this definition">¶</a></dt>
<dd><p>The body of the response, as a string. This is the final page content as
rendered by the view, or any error message.</p>
</dd></dl>

<dl class="attribute">
<dt id="Response.context">
<code class="descname">context</code><a class="headerlink" href="#Response.context" title="Permalink to this definition">¶</a></dt>
<dd><p>The template <code class="docutils literal"><span class="pre">Context</span></code> instance that was used to render the template that
produced the response content.</p>
<p>If the rendered page used multiple templates, then <code class="docutils literal"><span class="pre">context</span></code> will be a
list of <code class="docutils literal"><span class="pre">Context</span></code> objects, in the order in which they were rendered.</p>
<p>Regardless of the number of templates used during rendering, you can
retrieve context values using the <code class="docutils literal"><span class="pre">[]</span></code> operator. For example, the
context variable <code class="docutils literal"><span class="pre">name</span></code> could be retrieved using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/foo/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
<span class="go">&#39;Arthur&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Response.request">
<code class="descname">request</code><a class="headerlink" href="#Response.request" title="Permalink to this definition">¶</a></dt>
<dd><p>The request data that stimulated the response.</p>
</dd></dl>

<dl class="attribute">
<dt id="Response.wsgi_request">
<code class="descname">wsgi_request</code><a class="headerlink" href="#Response.wsgi_request" title="Permalink to this definition">¶</a></dt>
<dd><p>The <code class="docutils literal"><span class="pre">WSGIRequest</span></code> instance generated by the test handler that
generated the response.</p>
</dd></dl>

<dl class="attribute">
<dt id="Response.status_code">
<code class="descname">status_code</code><a class="headerlink" href="#Response.status_code" title="Permalink to this definition">¶</a></dt>
<dd><p>The HTTP status of the response, as an integer. See
<span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html#section-10"><strong>RFC 2616#section-10</strong></a> for a full list of HTTP status codes.</p>
</dd></dl>

<dl class="attribute">
<dt id="Response.templates">
<code class="descname">templates</code><a class="headerlink" href="#Response.templates" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of <code class="docutils literal"><span class="pre">Template</span></code> instances used to render the final content, in
the order they were rendered. For each template in the list, use
<code class="docutils literal"><span class="pre">template.name</span></code> to get the template&#8217;s file name, if the template was
loaded from a file. (The name is a string such as
<code class="docutils literal"><span class="pre">'admin/index.html'</span></code>.)</p>
</dd></dl>

<dl class="attribute">
<dt id="Response.resolver_match">
<code class="descname">resolver_match</code><a class="headerlink" href="#Response.resolver_match" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of <code class="xref py py-class docutils literal"><span class="pre">ResolverMatch</span></code> for the
response. You can use the
<code class="xref py py-attr docutils literal"><span class="pre">func</span></code> attribute, for
example, to verify the view that served the response:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># my_view here is a function based view</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">resolver_match</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">my_view</span><span class="p">)</span>

<span class="c"># class based views need to be compared by name, as the functions</span>
<span class="c"># generated by as_view() won&#39;t be equal</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">resolver_match</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">MyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>If the given URL is not found, accessing this attribute will raise a
<code class="xref py py-exc docutils literal"><span class="pre">Resolver404</span></code> exception.</p>
</dd></dl>

</dd></dl>

<p>You can also use dictionary syntax on the response object to query the value
of any settings in the HTTP headers. For example, you could determine the
content type of a response using <code class="docutils literal"><span class="pre">response['Content-Type']</span></code>.</p>
</div>
<div class="section" id="exceptions">
<h4>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h4>
<p>If you point the test client at a view that raises an exception, that exception
will be visible in the test case. You can then use a standard <code class="docutils literal"><span class="pre">try</span> <span class="pre">...</span> <span class="pre">except</span></code>
block or <code class="xref py py-meth docutils literal"><span class="pre">assertRaises()</span></code> to test for exceptions.</p>
<p>The only exceptions that are not visible to the test client are
<code class="xref py py-class docutils literal"><span class="pre">Http404</span></code>,
<code class="xref py py-class docutils literal"><span class="pre">PermissionDenied</span></code>, <code class="xref py py-exc docutils literal"><span class="pre">SystemExit</span></code>, and
<code class="xref py py-class docutils literal"><span class="pre">SuspiciousOperation</span></code>. Django catches these
exceptions internally and converts them into the appropriate HTTP response
codes. In these cases, you can check <code class="docutils literal"><span class="pre">response.status_code</span></code> in your test.</p>
</div>
<div class="section" id="persistent-state">
<h4>Persistent state<a class="headerlink" href="#persistent-state" title="Permalink to this headline">¶</a></h4>
<p>The test client is stateful. If a response returns a cookie, then that cookie
will be stored in the test client and sent with all subsequent <code class="docutils literal"><span class="pre">get()</span></code> and
<code class="docutils literal"><span class="pre">post()</span></code> requests.</p>
<p>Expiration policies for these cookies are not followed. If you want a cookie
to expire, either delete it manually or create a new <code class="docutils literal"><span class="pre">Client</span></code> instance (which
will effectively delete all cookies).</p>
<p>A test client has two attributes that store persistent state information. You
can access these properties as part of a test condition.</p>
<dl class="attribute">
<dt id="Client.cookies">
<code class="descclassname">Client.</code><code class="descname">cookies</code><a class="headerlink" href="#Client.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>A Python <code class="xref py py-class docutils literal"><span class="pre">SimpleCookie</span></code> object, containing the current
values of all the client cookies. See the documentation of the
<code class="xref py py-mod docutils literal"><span class="pre">http.cookies</span></code> module for more.</p>
</dd></dl>

<dl class="attribute">
<dt id="Client.session">
<code class="descclassname">Client.</code><code class="descname">session</code><a class="headerlink" href="#Client.session" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary-like object containing session information. See the
session documentation for full details.</p>
<p>To modify the session and then save it, it must be stored in a variable
first (because a new <code class="docutils literal"><span class="pre">SessionStore</span></code> is created every time this property
is accessed):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">session</span>
    <span class="n">session</span><span class="p">[</span><span class="s">&#39;somekey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
    <span class="n">session</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>The following is a simple unit test using the test client:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="k">class</span> <span class="nc">SimpleTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Every test needs a client.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue a GET request.</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/details/&#39;</span><span class="p">)</span>

        <span class="c"># Check that the response is 200 OK.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

        <span class="c"># Check that the rendered context contains 5 customers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;customers&#39;</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="provided-test-case-classes">
<span id="django-testcase-subclasses"></span><h3>Provided test case classes<a class="headerlink" href="#provided-test-case-classes" title="Permalink to this headline">¶</a></h3>
<p>Normal Python unit test classes extend a base class of
<code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code>. Django provides a few extensions of this base class:</p>
<div class="section" id="simpletestcase">
<h4>SimpleTestCase<a class="headerlink" href="#simpletestcase" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="SimpleTestCase">
<em class="property">class </em><code class="descname">SimpleTestCase</code><a class="headerlink" href="#SimpleTestCase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A thin subclass of <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code>, it extends it with some basic
functionality like:</p>
<ul class="simple">
<li>Saving and restoring the Python warning machinery state.</li>
<li>Some useful assertions like:<ul>
<li>Checking that a callable <a class="reference internal" href="#SimpleTestCase.assertRaisesMessage" title="SimpleTestCase.assertRaisesMessage"><code class="xref py py-meth docutils literal"><span class="pre">raises</span> <span class="pre">a</span> <span class="pre">certain</span> <span class="pre">exception</span></code></a>.</li>
<li>Testing form field <a class="reference internal" href="#SimpleTestCase.assertFieldOutput" title="SimpleTestCase.assertFieldOutput"><code class="xref py py-meth docutils literal"><span class="pre">rendering</span> <span class="pre">and</span> <span class="pre">error</span> <span class="pre">treatment</span></code></a>.</li>
<li>Testing <a class="reference internal" href="#SimpleTestCase.assertContains" title="SimpleTestCase.assertContains"><code class="xref py py-meth docutils literal"><span class="pre">HTML</span> <span class="pre">responses</span> <span class="pre">for</span> <span class="pre">the</span> <span class="pre">presence/lack</span> <span class="pre">of</span> <span class="pre">a</span> <span class="pre">given</span> <span class="pre">fragment</span></code></a>.</li>
<li>Verifying that a template <a class="reference internal" href="#SimpleTestCase.assertTemplateUsed" title="SimpleTestCase.assertTemplateUsed"><code class="xref py py-meth docutils literal"><span class="pre">has/hasn't</span> <span class="pre">been</span> <span class="pre">used</span> <span class="pre">to</span> <span class="pre">generate</span> <span class="pre">a</span> <span class="pre">given</span>
<span class="pre">response</span> <span class="pre">content</span></code></a>.</li>
<li>Verifying a HTTP <a class="reference internal" href="#SimpleTestCase.assertRedirects" title="SimpleTestCase.assertRedirects"><code class="xref py py-meth docutils literal"><span class="pre">redirect</span></code></a> is
performed by the app.</li>
<li>Robustly testing two <a class="reference internal" href="#SimpleTestCase.assertHTMLEqual" title="SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">HTML</span> <span class="pre">fragments</span></code></a>
for equality/inequality or <a class="reference internal" href="#SimpleTestCase.assertInHTML" title="SimpleTestCase.assertInHTML"><code class="xref py py-meth docutils literal"><span class="pre">containment</span></code></a>.</li>
<li>Robustly testing two <a class="reference internal" href="#SimpleTestCase.assertXMLEqual" title="SimpleTestCase.assertXMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">XML</span> <span class="pre">fragments</span></code></a>
for equality/inequality.</li>
<li>Robustly testing two <a class="reference internal" href="#SimpleTestCase.assertJSONEqual" title="SimpleTestCase.assertJSONEqual"><code class="xref py py-meth docutils literal"><span class="pre">JSON</span> <span class="pre">fragments</span></code></a>
for equality.</li>
</ul>
</li>
<li>The ability to run tests with modified settings.</li>
<li>Using the <a class="reference internal" href="#SimpleTestCase.client" title="SimpleTestCase.client"><code class="xref py py-attr docutils literal"><span class="pre">client</span></code></a> <code class="xref py py-class docutils literal"><span class="pre">Client</span></code>.</li>
<li>Custom test-time <code class="xref py py-attr docutils literal"><span class="pre">URL</span> <span class="pre">maps</span></code>.</li>
</ul>
<p>If you need any of the other more complex and heavyweight Django-specific
features like:</p>
<ul class="simple">
<li>Testing or using the ORM.</li>
<li>Database <a class="reference internal" href="#TransactionTestCase.fixtures" title="TransactionTestCase.fixtures"><code class="xref py py-attr docutils literal"><span class="pre">fixtures</span></code></a>.</li>
<li>Test skipping based on database backend features.</li>
<li>The remaining specialized <a class="reference internal" href="#TransactionTestCase.assertQuerysetEqual" title="TransactionTestCase.assertQuerysetEqual"><code class="xref py py-meth docutils literal"><span class="pre">assert*</span></code></a> methods.</li>
</ul>
<p>then you should use <code class="xref py py-class docutils literal"><span class="pre">TransactionTestCase</span></code> or
<code class="xref py py-class docutils literal"><span class="pre">TestCase</span></code> instead.</p>
<p><code class="docutils literal"><span class="pre">SimpleTestCase</span></code> inherits from <code class="docutils literal"><span class="pre">unittest.TestCase</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><code class="docutils literal"><span class="pre">SimpleTestCase</span></code> and its subclasses (e.g. <code class="docutils literal"><span class="pre">TestCase</span></code>, ...) rely on
<code class="docutils literal"><span class="pre">setUpClass()</span></code> and <code class="docutils literal"><span class="pre">tearDownClass()</span></code> to perform some class-wide
initialization (e.g. overriding settings). If you need to override those
methods, don&#8217;t forget to call the <code class="docutils literal"><span class="pre">super</span></code> implementation:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">MyTestCase</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>     <span class="c"># Call parent first</span>
        <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">MyTestCase</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownClass</span><span class="p">()</span>  <span class="c"># Call parent last</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transactiontestcase">
<h4>TransactionTestCase<a class="headerlink" href="#transactiontestcase" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="TransactionTestCase">
<em class="property">class </em><code class="descname">TransactionTestCase</code><a class="headerlink" href="#TransactionTestCase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Django&#8217;s <code class="docutils literal"><span class="pre">TestCase</span></code> class (described below) makes use of database transaction
facilities to speed up the process of resetting the database to a known state
at the beginning of each test. A consequence of this, however, is that some
database behaviors cannot be tested within a Django <code class="docutils literal"><span class="pre">TestCase</span></code> class. For
instance, you cannot test that a block of code is executing within a
transaction, as is required when using
<code class="xref py py-meth docutils literal"><span class="pre">select_for_update()</span></code>. In those cases,
you should use <code class="docutils literal"><span class="pre">TransactionTestCase</span></code>.</p>
<p>In older versions of Django, the effects of transaction commit and rollback
could not be tested within a <code class="docutils literal"><span class="pre">TestCase</span></code>.  With the completion of the
deprecation cycle of the old-style transaction management in Django 1.8,
transaction management commands (e.g. <code class="docutils literal"><span class="pre">transaction.commit()</span></code>) are no
longer disabled within <code class="docutils literal"><span class="pre">TestCase</span></code>.</p>
<p><code class="docutils literal"><span class="pre">TransactionTestCase</span></code> and <code class="docutils literal"><span class="pre">TestCase</span></code> are identical except for the manner
in which the database is reset to a known state and the ability for test code
to test the effects of commit and rollback:</p>
<ul class="simple">
<li>A <code class="docutils literal"><span class="pre">TransactionTestCase</span></code> resets the database after the test runs by
truncating all tables. A <code class="docutils literal"><span class="pre">TransactionTestCase</span></code> may call commit and rollback
and observe the effects of these calls on the database.</li>
<li>A <code class="docutils literal"><span class="pre">TestCase</span></code>, on the other hand, does not truncate tables after a test.
Instead, it encloses the test code in a database transaction that is rolled
back at the end of the test. This guarantees that the rollback at the end of
the test restores the database to its initial state.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><code class="docutils literal"><span class="pre">TestCase</span></code> running on a database that does not support rollback (e.g. MySQL
with the MyISAM storage engine), and all instances of <code class="docutils literal"><span class="pre">TransactionTestCase</span></code>,
will roll back at the end of the test by deleting all data from the test
database.</p>
<p class="last">Apps will not see their data reloaded;
if you need this functionality (for example, third-party apps should enable
this) you can set <code class="docutils literal"><span class="pre">serialized_rollback</span> <span class="pre">=</span> <span class="pre">True</span></code> inside the
<code class="docutils literal"><span class="pre">TestCase</span></code> body.</p>
</div>
<p><code class="docutils literal"><span class="pre">TransactionTestCase</span></code> inherits from <code class="xref py py-class docutils literal"><span class="pre">SimpleTestCase</span></code>.</p>
</div>
<div class="section" id="testcase">
<h4>TestCase<a class="headerlink" href="#testcase" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="TestCase">
<em class="property">class </em><code class="descname">TestCase</code><a class="headerlink" href="#TestCase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This class provides some additional capabilities that can be useful for testing
Web sites.</p>
<p>Converting a normal <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code> to a Django <a class="reference internal" href="#TestCase" title="TestCase"><code class="xref py py-class docutils literal"><span class="pre">TestCase</span></code></a> is
easy: Just change the base class of your test from <code class="docutils literal"><span class="pre">'unittest.TestCase'</span></code> to
<code class="docutils literal"><span class="pre">'django.test.TestCase'</span></code>. All of the standard Python unit test functionality
will continue to be available, but it will be augmented with some useful
additions, including:</p>
<ul class="simple">
<li>Automatic loading of fixtures.</li>
<li>Wraps the tests within two nested <code class="docutils literal"><span class="pre">atomic</span></code> blocks: one for the whole class
and one for each test.</li>
<li>Creates a TestClient instance.</li>
<li>Django-specific assertions for testing for things like redirection and form
errors.</li>
</ul>
<dl class="classmethod">
<dt id="TestCase.setUpTestData">
<em class="property">classmethod </em><code class="descclassname">TestCase.</code><code class="descname">setUpTestData</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TestCase.setUpTestData" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The class-level <code class="docutils literal"><span class="pre">atomic</span></code> block described above allows the creation of
initial data at the class level, once for the whole <code class="docutils literal"><span class="pre">TestCase</span></code>. This
technique allows for faster tests as compared to using <code class="docutils literal"><span class="pre">setUp()</span></code>.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpTestData</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c"># Set up data for the whole TestCase</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="s">&quot;Test&quot;</span><span class="p">)</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Some test using self.foo</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">test2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Some other test using self.foo</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Note that if the tests are run on a database with no transaction support
(for instance, MySQL with the MyISAM engine), <code class="docutils literal"><span class="pre">setUpTestData()</span></code> will be
called before each test, negating the speed benefits.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you want to test some specific database transaction behavior, you should
use <code class="docutils literal"><span class="pre">TransactionTestCase</span></code>, as <code class="docutils literal"><span class="pre">TestCase</span></code> wraps test execution within an
<code class="xref py py-func docutils literal"><span class="pre">atomic()</span></code> block.</p>
</div>
<p><code class="docutils literal"><span class="pre">TestCase</span></code> inherits from <code class="xref py py-class docutils literal"><span class="pre">TransactionTestCase</span></code>.</p>
</div>
<div class="section" id="liveservertestcase">
<span id="live-test-server"></span><h4>LiveServerTestCase<a class="headerlink" href="#liveservertestcase" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="LiveServerTestCase">
<em class="property">class </em><code class="descname">LiveServerTestCase</code><a class="headerlink" href="#LiveServerTestCase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal"><span class="pre">LiveServerTestCase</span></code> does basically the same as
<code class="xref py py-class docutils literal"><span class="pre">TransactionTestCase</span></code> with one extra feature: it launches a
live Django server in the background on setup, and shuts it down on teardown.
This allows the use of automated test clients other than the
Django dummy client such as, for example, the <a class="reference external" href="http://seleniumhq.org/">Selenium</a>
client, to execute a series of functional tests inside a browser and simulate a
real user&#8217;s actions.</p>
<p>By default the live server&#8217;s address is <code class="docutils literal"><span class="pre">'localhost:8081'</span></code> and the full URL
can be accessed during the tests with <code class="docutils literal"><span class="pre">self.live_server_url</span></code>. If you&#8217;d like
to change the default address (in the case, for example, where the 8081 port is
already taken) then you may pass a different one to the test command
via the <code class="docutils literal"><span class="pre">--liveserver</span></code> option, for example:</p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py <span class="nb">test</span> --liveserver<span class="o">=</span>localhost:8082
</pre></div>
</div>
<p>Another way of changing the default server address is by setting the
<cite>DJANGO_LIVE_TEST_SERVER_ADDRESS</cite> environment variable somewhere in your
code (for example, in a custom test runner):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_LIVE_TEST_SERVER_ADDRESS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;localhost:8082&#39;</span>
</pre></div>
</div>
<p>In the case where the tests are run by multiple processes in parallel (for
example, in the context of several simultaneous <a class="reference external" href="http://en.wikipedia.org/wiki/Continuous_integration">continuous integration</a>
builds), the processes will compete for the same address, and therefore your
tests might randomly fail with an &#8220;Address already in use&#8221; error. To avoid this
problem, you can pass a comma-separated list of ports or ranges of ports (at
least as many as the number of potential parallel processes). For example:</p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py <span class="nb">test</span> --liveserver<span class="o">=</span>localhost:8082,8090-8100,9000-9200,7041
</pre></div>
</div>
<p>Then, during test execution, each new live test server will try every specified
port until it finds one that is free and takes it.</p>
<p>To demonstrate how to use <code class="docutils literal"><span class="pre">LiveServerTestCase</span></code>, let&#8217;s write a simple Selenium
test. First of all, you need to install the <a class="reference external" href="https://pypi.python.org/pypi/selenium">selenium package</a> into your
Python path:</p>
<div class="highlight-bash"><div class="highlight"><pre>pip install selenium
</pre></div>
</div>
<p>Then, add a <code class="docutils literal"><span class="pre">LiveServerTestCase</span></code>-based test to your app&#8217;s tests module
(for example: <code class="docutils literal"><span class="pre">myapp/tests.py</span></code>). The code for this test may look as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">LiveServerTestCase</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.webdriver</span> <span class="kn">import</span> <span class="n">WebDriver</span>

<span class="k">class</span> <span class="nc">MySeleniumTests</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;user-data.json&#39;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySeleniumTests</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">selenium</span> <span class="o">=</span> <span class="n">WebDriver</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySeleniumTests</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownClass</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span><span class="p">,</span> <span class="s">&#39;/login/&#39;</span><span class="p">))</span>
        <span class="n">username_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">)</span>
        <span class="n">username_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;myuser&#39;</span><span class="p">)</span>
        <span class="n">password_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
        <span class="n">password_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">&#39;//input[@value=&quot;Log in&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, you may run the test as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py <span class="nb">test </span>myapp.tests.MySeleniumTests.test_login
</pre></div>
</div>
<p>This example will automatically open Firefox then go to the login page, enter
the credentials and press the &#8220;Log in&#8221; button. Selenium offers other drivers in
case you do not have Firefox installed or wish to use another browser. The
example above is just a tiny fraction of what the Selenium client can do; check
out the <a class="reference external" href="http://selenium-python.readthedocs.org/en/latest/api.html">full reference</a> for more details.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you use the <code class="xref py py-mod docutils literal"><span class="pre">staticfiles</span></code> app in your project and
need to perform live testing, then you might want to use the
<code class="xref py py-class docutils literal"><span class="pre">StaticLiveServerTestCase</span></code>
subclass which transparently serves all the assets during execution of
its tests in a way very similar to what we get at development time with
<code class="docutils literal"><span class="pre">DEBUG=True</span></code>, i.e. without having to collect them using
<code class="docutils literal"><span class="pre">collectstatic</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When using an in-memory SQLite database to run the tests, the same database
connection will be shared by two threads in parallel: the thread in which
the live server is run and the thread in which the test case is run. It&#8217;s
important to prevent simultaneous database queries via this shared
connection by the two threads, as that may sometimes randomly cause the
tests to fail. So you need to ensure that the two threads don&#8217;t access the
database at the same time. In particular, this means that in some cases
(for example, just after clicking a link or submitting a form), you might
need to check that a response is received by Selenium and that the next
page is loaded before proceeding with further test execution.
Do this, for example, by making Selenium wait until the <code class="docutils literal"><span class="pre">&lt;body&gt;</span></code> HTML tag
is found in the response (requires Selenium &gt; 2.13):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">&#39;//input[@value=&quot;Log in&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="c"># Wait until the response is received</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">driver</span><span class="p">:</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p class="last">The tricky thing here is that there&#8217;s really no such thing as a &#8220;page load,&#8221;
especially in modern Web apps that generate HTML dynamically after the
server generates the initial document. So, simply checking for the presence
of <code class="docutils literal"><span class="pre">&lt;body&gt;</span></code> in the response might not necessarily be appropriate for all
use cases. Please refer to the <a class="reference external" href="http://code.google.com/p/selenium/wiki/FrequentlyAskedQuestions#Q:_WebDriver_fails_to_find_elements_/_Does_not_block_on_page_loa">Selenium FAQ</a> and
<a class="reference external" href="http://seleniumhq.org/docs/04_webdriver_advanced.html#explicit-waits">Selenium documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="section" id="test-cases-features">
<h3>Test cases features<a class="headerlink" href="#test-cases-features" title="Permalink to this headline">¶</a></h3>
<div class="section" id="default-test-client">
<h4>Default test client<a class="headerlink" href="#default-test-client" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="SimpleTestCase.client">
<code class="descclassname">SimpleTestCase.</code><code class="descname">client</code><a class="headerlink" href="#SimpleTestCase.client" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Every test case in a <code class="docutils literal"><span class="pre">django.test.*TestCase</span></code> instance has access to an
instance of a Django test client. This client can be accessed as
<code class="docutils literal"><span class="pre">self.client</span></code>. This client is recreated for each test, so you don&#8217;t have to
worry about state (such as cookies) carrying over from one test to another.</p>
<p>This means, instead of instantiating a <code class="docutils literal"><span class="pre">Client</span></code> in each test:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="k">class</span> <span class="nc">SimpleTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/details/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/index/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>...you can just refer to <code class="docutils literal"><span class="pre">self.client</span></code>, like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">SimpleTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/details/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/index/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-the-test-client">
<h4>Customizing the test client<a class="headerlink" href="#customizing-the-test-client" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="SimpleTestCase.client_class">
<code class="descclassname">SimpleTestCase.</code><code class="descname">client_class</code><a class="headerlink" href="#SimpleTestCase.client_class" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>If you want to use a different <code class="docutils literal"><span class="pre">Client</span></code> class (for example, a subclass
with customized behavior), use the <a class="reference internal" href="#SimpleTestCase.client_class" title="SimpleTestCase.client_class"><code class="xref py py-attr docutils literal"><span class="pre">client_class</span></code></a> class
attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">Client</span>

<span class="k">class</span> <span class="nc">MyTestClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    <span class="c"># Specialized methods for your environment</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">client_class</span> <span class="o">=</span> <span class="n">MyTestClient</span>

    <span class="k">def</span> <span class="nf">test_my_stuff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Here self.client is an instance of MyTestClient...</span>
        <span class="n">call_some_test_code</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="fixture-loading">
<span id="topics-testing-fixtures"></span><h4>Fixture loading<a class="headerlink" href="#fixture-loading" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="TransactionTestCase.fixtures">
<code class="descclassname">TransactionTestCase.</code><code class="descname">fixtures</code><a class="headerlink" href="#TransactionTestCase.fixtures" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A test case for a database-backed Web site isn&#8217;t much use if there isn&#8217;t any
data in the database. To make it easy to put test data into the database,
Django&#8217;s custom <code class="docutils literal"><span class="pre">TransactionTestCase</span></code> class provides a way of loading
<strong>fixtures</strong>.</p>
<p>A fixture is a collection of data that Django knows how to import into a
database. For example, if your site has user accounts, you might set up a
fixture of fake user accounts in order to populate your database during tests.</p>
<p>The most straightforward way of creating a fixture is to use the
manage.py dumpdata  command. This assumes you
already have some data in your database. See the dumpdata
documentation for more details.</p>
<p>Once you&#8217;ve created a fixture and placed it in a <code class="docutils literal"><span class="pre">fixtures</span></code> directory in one
of your <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code>, you can use it in your unit tests by
specifying a <code class="docutils literal"><span class="pre">fixtures</span></code> class attribute on your <code class="xref py py-class docutils literal"><span class="pre">django.test.TestCase</span></code>
subclass:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Animal</span>

<span class="k">class</span> <span class="nc">AnimalTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;mammals.json&#39;</span><span class="p">,</span> <span class="s">&#39;birds&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test definitions as before.</span>
        <span class="n">call_setup_methods</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testFluffyAnimals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A test that uses the fixtures.</span>
        <span class="n">call_some_test_code</span><span class="p">()</span>
</pre></div>
</div>
<p>Here&#8217;s specifically what will happen:</p>
<ul class="simple">
<li>At the start of each test case, before <code class="docutils literal"><span class="pre">setUp()</span></code> is run, Django will
flush the database, returning the database to the state it was in
directly after <code class="docutils literal"><span class="pre">migrate</span></code> was called.</li>
<li>Then, all the named fixtures are installed. In this example, Django will
install any JSON fixture named <code class="docutils literal"><span class="pre">mammals</span></code>, followed by any fixture named
<code class="docutils literal"><span class="pre">birds</span></code>. See the <code class="docutils literal"><span class="pre">loaddata</span></code> documentation for more
details on defining and installing fixtures.</li>
</ul>
<p>This flush/load procedure is repeated for each test in the test case, so you
can be certain that the outcome of a test will not be affected by another test,
or by the order of test execution.</p>
<p>By default, fixtures are only loaded into the <code class="docutils literal"><span class="pre">default</span></code> database. If you are
using multiple databases and set <a class="reference internal" href="#TransactionTestCase.multi_db" title="TransactionTestCase.multi_db"><code class="xref py py-attr docutils literal"><span class="pre">multi_db=True</span></code></a>, fixtures will be loaded into all databases.</p>
</div>
<div class="section" id="multi-database-support">
<span id="emptying-test-outbox"></span><h4>Multi-database support<a class="headerlink" href="#multi-database-support" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="TransactionTestCase.multi_db">
<code class="descclassname">TransactionTestCase.</code><code class="descname">multi_db</code><a class="headerlink" href="#TransactionTestCase.multi_db" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Django sets up a test database corresponding to every database that is
defined in the <code class="docutils literal"><span class="pre">DATABASES</span></code> definition in your settings
file. However, a big part of the time taken to run a Django TestCase
is consumed by the call to <code class="docutils literal"><span class="pre">flush</span></code> that ensures that you have a
clean database at the start of each test run. If you have multiple
databases, multiple flushes are required (one for each database),
which can be a time consuming activity &#8211; especially if your tests
don&#8217;t need to test multi-database activity.</p>
<p>As an optimization, Django only flushes the <code class="docutils literal"><span class="pre">default</span></code> database at
the start of each test run. If your setup contains multiple databases,
and you have a test that requires every database to be clean, you can
use the <code class="docutils literal"><span class="pre">multi_db</span></code> attribute on the test suite to request a full
flush.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestMyViews</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">multi_db</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">testIndexPageView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">call_some_test_code</span><span class="p">()</span>
</pre></div>
</div>
<p>This test case will flush <em>all</em> the test databases before running
<code class="docutils literal"><span class="pre">testIndexPageView</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">multi_db</span></code> flag also affects into which databases the
attr:<cite>TransactionTestCase.fixtures</cite> are loaded. By default (when
<code class="docutils literal"><span class="pre">multi_db=False</span></code>), fixtures are only loaded into the <code class="docutils literal"><span class="pre">default</span></code> database.
If <code class="docutils literal"><span class="pre">multi_db=True</span></code>, fixtures are loaded into all databases.</p>
</div>
<div class="section" id="overriding-settings">
<span id="id3"></span><h4>Overriding settings<a class="headerlink" href="#overriding-settings" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Use the functions below to temporarily alter the value of settings in tests.
Don&#8217;t manipulate <code class="docutils literal"><span class="pre">django.conf.settings</span></code> directly as Django won&#8217;t restore
the original values after such manipulations.</p>
</div>
<dl class="method">
<dt id="SimpleTestCase.settings">
<code class="descclassname">SimpleTestCase.</code><code class="descname">settings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.settings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>For testing purposes it&#8217;s often useful to change a setting temporarily and
revert to the original value after running the testing code. For this use case
Django provides a standard Python context manager (see <span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0343"><strong>PEP 343</strong></a>) called
<code class="xref py py-meth docutils literal"><span class="pre">settings()</span></code>, which can be used like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">LoginTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># First check for the default behavior</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/sekrit/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/accounts/login/?next=/sekrit/&#39;</span><span class="p">)</span>

        <span class="c"># Then override the LOGIN_URL setting</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LOGIN_URL</span><span class="o">=</span><span class="s">&#39;/other/login/&#39;</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/sekrit/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/other/login/?next=/sekrit/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This example will override the <code class="docutils literal"><span class="pre">LOGIN_URL</span></code> setting for the code
in the <code class="docutils literal"><span class="pre">with</span></code> block and reset its value to the previous state afterwards.</p>
<dl class="method">
<dt id="SimpleTestCase.modify_settings">
<code class="descclassname">SimpleTestCase.</code><code class="descname">modify_settings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.modify_settings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It can prove unwieldy to redefine settings that contain a list of values. In
practice, adding or removing values is often sufficient. The
<code class="xref py py-meth docutils literal"><span class="pre">modify_settings()</span></code> context manager makes it
easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">MiddlewareTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_cache_middleware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">modify_settings</span><span class="p">(</span><span class="n">MIDDLEWARE_CLASSES</span><span class="o">=</span><span class="p">{</span>
            <span class="s">&#39;append&#39;</span><span class="p">:</span> <span class="s">&#39;django.middleware.cache.FetchFromCacheMiddleware&#39;</span><span class="p">,</span>
            <span class="s">&#39;prepend&#39;</span><span class="p">:</span> <span class="s">&#39;django.middleware.cache.UpdateCacheMiddleware&#39;</span><span class="p">,</span>
            <span class="s">&#39;remove&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
                <span class="s">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
                <span class="s">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">}):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="c"># ...</span>
</pre></div>
</div>
<p>For each action, you can supply either a list of values or a string. When the
value already exists in the list, <code class="docutils literal"><span class="pre">append</span></code> and <code class="docutils literal"><span class="pre">prepend</span></code> have no effect;
neither does <code class="docutils literal"><span class="pre">remove</span></code> when the value doesn&#8217;t exist.</p>
<dl class="function">
<dt id="override_settings">
<code class="descname">override_settings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#override_settings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>In case you want to override a setting for a test method, Django provides the
<code class="xref py py-func docutils literal"><span class="pre">override_settings()</span></code> decorator (see <span class="target" id="index-3"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0318"><strong>PEP 318</strong></a>). It&#8217;s used
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">override_settings</span>

<span class="k">class</span> <span class="nc">LoginTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@override_settings</span><span class="p">(</span><span class="n">LOGIN_URL</span><span class="o">=</span><span class="s">&#39;/other/login/&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/sekrit/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/other/login/?next=/sekrit/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The decorator can also be applied to <code class="xref py py-class docutils literal"><span class="pre">TestCase</span></code> classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">override_settings</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">LOGIN_URL</span><span class="o">=</span><span class="s">&#39;/other/login/&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoginTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/sekrit/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/other/login/?next=/sekrit/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="function">
<dt id="modify_settings">
<code class="descname">modify_settings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#modify_settings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Likewise, Django provides the <code class="xref py py-func docutils literal"><span class="pre">modify_settings()</span></code>
decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">modify_settings</span>

<span class="k">class</span> <span class="nc">MiddlewareTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@modify_settings</span><span class="p">(</span><span class="n">MIDDLEWARE_CLASSES</span><span class="o">=</span><span class="p">{</span>
        <span class="s">&#39;append&#39;</span><span class="p">:</span> <span class="s">&#39;django.middleware.cache.FetchFromCacheMiddleware&#39;</span><span class="p">,</span>
        <span class="s">&#39;prepend&#39;</span><span class="p">:</span> <span class="s">&#39;django.middleware.cache.UpdateCacheMiddleware&#39;</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">def</span> <span class="nf">test_cache_middleware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="c"># ...</span>
</pre></div>
</div>
<p>The decorator can also be applied to test case classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">modify_settings</span>

<span class="nd">@modify_settings</span><span class="p">(</span><span class="n">MIDDLEWARE_CLASSES</span><span class="o">=</span><span class="p">{</span>
    <span class="s">&#39;append&#39;</span><span class="p">:</span> <span class="s">&#39;django.middleware.cache.FetchFromCacheMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;prepend&#39;</span><span class="p">:</span> <span class="s">&#39;django.middleware.cache.UpdateCacheMiddleware&#39;</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">class</span> <span class="nc">MiddlewareTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_cache_middleware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="c"># ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When given a class, these decorators modify the class directly and return
it; they don&#8217;t create and return a modified copy of it. So if you try to
tweak the above examples to assign the return value to a different name
than <code class="docutils literal"><span class="pre">LoginTestCase</span></code> or <code class="docutils literal"><span class="pre">MiddlewareTestCase</span></code>, you may be surprised to
find that the original test case classes are still equally affected by the
decorator. For a given class, <code class="xref py py-func docutils literal"><span class="pre">modify_settings()</span></code> is
always applied after <code class="xref py py-func docutils literal"><span class="pre">override_settings()</span></code>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The settings file contains some settings that are only consulted during
initialization of Django internals. If you change them with
<code class="docutils literal"><span class="pre">override_settings</span></code>, the setting is changed if you access it via the
<code class="docutils literal"><span class="pre">django.conf.settings</span></code> module, however, Django&#8217;s internals access it
differently. Effectively, using <code class="xref py py-func docutils literal"><span class="pre">override_settings()</span></code> or
<code class="xref py py-func docutils literal"><span class="pre">modify_settings()</span></code> with these settings is probably not
going to do what you expect it to do.</p>
<p>We do not recommend altering the <code class="docutils literal"><span class="pre">DATABASES</span></code> setting. Altering
the <code class="docutils literal"><span class="pre">CACHES</span></code> setting is possible, but a bit tricky if you are
using internals that make using of caching, like
<code class="xref py py-mod docutils literal"><span class="pre">django.contrib.sessions</span></code>. For example, you will have to reinitialize
the session backend in a test that uses cached sessions and overrides
<code class="docutils literal"><span class="pre">CACHES</span></code>.</p>
<p class="last">Finally, avoid aliasing your settings as module-level constants as
<code class="docutils literal"><span class="pre">override_settings()</span></code> won&#8217;t work on such values since they are
only evaluated the first time the module is imported.</p>
</div>
<p>You can also simulate the absence of a setting by deleting it after settings
have been overridden, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@override_settings</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOGIN_URL</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>When overriding settings, make sure to handle the cases in which your app&#8217;s
code uses a cache or similar feature that retains state even if the setting is
changed. Django provides the <code class="xref py py-data docutils literal"><span class="pre">django.test.signals.setting_changed</span></code>
signal that lets you register callbacks to clean up and otherwise reset state
when settings are changed.</p>
<p>Django itself uses this signal to reset various data:</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Overridden settings</th>
<th class="head">Data reset</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>USE_TZ, TIME_ZONE</td>
<td>Databases timezone</td>
</tr>
<tr class="row-odd"><td>TEMPLATES</td>
<td>Template engines</td>
</tr>
<tr class="row-even"><td>SERIALIZATION_MODULES</td>
<td>Serializers cache</td>
</tr>
<tr class="row-odd"><td>LOCALE_PATHS, LANGUAGE_CODE</td>
<td>Default translation and loaded translations</td>
</tr>
<tr class="row-even"><td>MEDIA_ROOT, DEFAULT_FILE_STORAGE</td>
<td>Default file storage</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="emptying-the-test-outbox">
<h4>Emptying the test outbox<a class="headerlink" href="#emptying-the-test-outbox" title="Permalink to this headline">¶</a></h4>
<p>If you use any of Django&#8217;s custom <code class="docutils literal"><span class="pre">TestCase</span></code> classes, the test runner will
clear the contents of the test email outbox at the start of each test case.</p>
<p>For more detail on email services during tests, see <a class="reference internal" href="#email-services">Email services</a> below.</p>
</div>
<div class="section" id="assertions">
<span id="id4"></span><h4>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h4>
<p>As Python&#8217;s normal <code class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></code> class implements assertion methods
such as <code class="xref py py-meth docutils literal"><span class="pre">assertTrue()</span></code> and
<code class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></code>, Django&#8217;s custom <a class="reference internal" href="#TestCase" title="TestCase"><code class="xref py py-class docutils literal"><span class="pre">TestCase</span></code></a> class
provides a number of custom assertion methods that are useful for testing Web
applications:</p>
<p>The failure messages given by most of these assertion methods can be customized
with the <code class="docutils literal"><span class="pre">msg_prefix</span></code> argument. This string will be prefixed to any failure
message generated by the assertion. This allows you to provide additional
details that may help you to identify the location and cause of an failure in
your test suite.</p>
<dl class="method">
<dt id="SimpleTestCase.assertRaisesMessage">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertRaisesMessage</code><span class="sig-paren">(</span><em>expected_exception</em>, <em>expected_message</em>, <em>callable_obj=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertRaisesMessage" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that execution of callable <code class="docutils literal"><span class="pre">callable_obj</span></code> raised the
<code class="docutils literal"><span class="pre">expected_exception</span></code> exception and that such exception has an
<code class="docutils literal"><span class="pre">expected_message</span></code> representation. Any other outcome is reported as a
failure. Similar to unittest&#8217;s <code class="xref py py-meth docutils literal"><span class="pre">assertRaisesRegex()</span></code>
with the difference that <code class="docutils literal"><span class="pre">expected_message</span></code> isn&#8217;t a regular expression.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertFieldOutput">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertFieldOutput</code><span class="sig-paren">(</span><em>fieldclass</em>, <em>valid</em>, <em>invalid</em>, <em>field_args=None</em>, <em>field_kwargs=None</em>, <em>empty_value=''</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertFieldOutput" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that a form field behaves correctly with various inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fieldclass</strong> &#8211; the class of the field to be tested.</li>
<li><strong>valid</strong> &#8211; a dictionary mapping valid inputs to their expected cleaned
values.</li>
<li><strong>invalid</strong> &#8211; a dictionary mapping invalid inputs to one or more raised
error messages.</li>
<li><strong>field_args</strong> &#8211; the args passed to instantiate the field.</li>
<li><strong>field_kwargs</strong> &#8211; the kwargs passed to instantiate the field.</li>
<li><strong>empty_value</strong> &#8211; the expected clean output for inputs in <code class="docutils literal"><span class="pre">empty_values</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>For example, the following code tests that an <code class="docutils literal"><span class="pre">EmailField</span></code> accepts
<code class="docutils literal"><span class="pre">a&#64;a.com</span></code> as a valid email address, but rejects <code class="docutils literal"><span class="pre">aaa</span></code> with a reasonable
error message:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">assertFieldOutput</span><span class="p">(</span><span class="n">EmailField</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a@a.com&#39;</span><span class="p">:</span> <span class="s">&#39;a@a.com&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;aaa&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Enter a valid email address.&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertFormError">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertFormError</code><span class="sig-paren">(</span><em>response</em>, <em>form</em>, <em>field</em>, <em>errors</em>, <em>msg_prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertFormError" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that a field on a form raises the provided list of errors when
rendered on the form.</p>
<p><code class="docutils literal"><span class="pre">form</span></code> is the name the <code class="docutils literal"><span class="pre">Form</span></code> instance was given in the template
context.</p>
<p><code class="docutils literal"><span class="pre">field</span></code> is the name of the field on the form to check. If <code class="docutils literal"><span class="pre">field</span></code>
has a value of <code class="docutils literal"><span class="pre">None</span></code>, non-field errors (errors you can access via
<code class="xref py py-meth docutils literal"><span class="pre">form.non_field_errors()</span></code>) will
be checked.</p>
<p><code class="docutils literal"><span class="pre">errors</span></code> is an error string, or a list of error strings, that are
expected as a result of form validation.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertFormsetError">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertFormsetError</code><span class="sig-paren">(</span><em>response</em>, <em>formset</em>, <em>form_index</em>, <em>field</em>, <em>errors</em>, <em>msg_prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertFormsetError" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the <code class="docutils literal"><span class="pre">formset</span></code> raises the provided list of errors when
rendered.</p>
<p><code class="docutils literal"><span class="pre">formset</span></code> is the name the <code class="docutils literal"><span class="pre">Formset</span></code> instance was given in the template
context.</p>
<p><code class="docutils literal"><span class="pre">form_index</span></code> is the number of the form within the <code class="docutils literal"><span class="pre">Formset</span></code>.  If
<code class="docutils literal"><span class="pre">form_index</span></code> has a value of <code class="docutils literal"><span class="pre">None</span></code>, non-form errors (errors you can
access via <code class="docutils literal"><span class="pre">formset.non_form_errors()</span></code>) will be checked.</p>
<p><code class="docutils literal"><span class="pre">field</span></code> is the name of the field on the form to check. If <code class="docutils literal"><span class="pre">field</span></code>
has a value of <code class="docutils literal"><span class="pre">None</span></code>, non-field errors (errors you can access via
<code class="xref py py-meth docutils literal"><span class="pre">form.non_field_errors()</span></code>) will
be checked.</p>
<p><code class="docutils literal"><span class="pre">errors</span></code> is an error string, or a list of error strings, that are
expected as a result of form validation.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertContains">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertContains</code><span class="sig-paren">(</span><em>response</em>, <em>text</em>, <em>count=None</em>, <em>status_code=200</em>, <em>msg_prefix=''</em>, <em>html=False</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertContains" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that a <code class="docutils literal"><span class="pre">Response</span></code> instance produced the given <code class="docutils literal"><span class="pre">status_code</span></code> and
that <code class="docutils literal"><span class="pre">text</span></code> appears in the content of the response. If <code class="docutils literal"><span class="pre">count</span></code> is
provided, <code class="docutils literal"><span class="pre">text</span></code> must occur exactly <code class="docutils literal"><span class="pre">count</span></code> times in the response.</p>
<p>Set <code class="docutils literal"><span class="pre">html</span></code> to <code class="docutils literal"><span class="pre">True</span></code> to handle <code class="docutils literal"><span class="pre">text</span></code> as HTML. The comparison with
the response content will be based on HTML semantics instead of
character-by-character equality. Whitespace is ignored in most cases,
attribute ordering is not significant. See
<a class="reference internal" href="#SimpleTestCase.assertHTMLEqual" title="SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertHTMLEqual()</span></code></a> for more details.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertNotContains">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertNotContains</code><span class="sig-paren">(</span><em>response</em>, <em>text</em>, <em>status_code=200</em>, <em>msg_prefix=''</em>, <em>html=False</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertNotContains" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that a <code class="docutils literal"><span class="pre">Response</span></code> instance produced the given <code class="docutils literal"><span class="pre">status_code</span></code> and
that <code class="docutils literal"><span class="pre">text</span></code> does not appears in the content of the response.</p>
<p>Set <code class="docutils literal"><span class="pre">html</span></code> to <code class="docutils literal"><span class="pre">True</span></code> to handle <code class="docutils literal"><span class="pre">text</span></code> as HTML. The comparison with
the response content will be based on HTML semantics instead of
character-by-character equality. Whitespace is ignored in most cases,
attribute ordering is not significant. See
<a class="reference internal" href="#SimpleTestCase.assertHTMLEqual" title="SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertHTMLEqual()</span></code></a> for more details.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertTemplateUsed">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertTemplateUsed</code><span class="sig-paren">(</span><em>response</em>, <em>template_name</em>, <em>msg_prefix=''</em>, <em>count=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertTemplateUsed" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the template with the given name was used in rendering the
response.</p>
<p>The name is a string such as <code class="docutils literal"><span class="pre">'admin/index.html'</span></code>.</p>
<p>The count argument is an integer indicating the number of times the
template should be rendered. Default is <code class="docutils literal"><span class="pre">None</span></code>, meaning that the
template should be rendered one or more times.</p>
<p>You can use this as a context manager, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">):</span>
    <span class="n">render_to_string</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">&#39;index.html&#39;</span><span class="p">):</span>
    <span class="n">render_to_string</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertTemplateNotUsed">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertTemplateNotUsed</code><span class="sig-paren">(</span><em>response</em>, <em>template_name</em>, <em>msg_prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertTemplateNotUsed" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the template with the given name was <em>not</em> used in rendering
the response.</p>
<p>You can use this as a context manager in the same way as
<a class="reference internal" href="#SimpleTestCase.assertTemplateUsed" title="SimpleTestCase.assertTemplateUsed"><code class="xref py py-meth docutils literal"><span class="pre">assertTemplateUsed()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertRedirects">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertRedirects</code><span class="sig-paren">(</span><em>response</em>, <em>expected_url</em>, <em>status_code=302</em>, <em>target_status_code=200</em>, <em>host=None</em>, <em>msg_prefix=''</em>, <em>fetch_redirect_response=True</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertRedirects" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the response returned a <code class="docutils literal"><span class="pre">status_code</span></code> redirect status,
redirected to <code class="docutils literal"><span class="pre">expected_url</span></code> (including any <code class="docutils literal"><span class="pre">GET</span></code> data), and that the
final page was received with <code class="docutils literal"><span class="pre">target_status_code</span></code>.</p>
<p>If your request used the <code class="docutils literal"><span class="pre">follow</span></code> argument, the <code class="docutils literal"><span class="pre">expected_url</span></code> and
<code class="docutils literal"><span class="pre">target_status_code</span></code> will be the url and status code for the final
point of the redirect chain.</p>
<p>The <code class="docutils literal"><span class="pre">host</span></code> argument sets a default host if <code class="docutils literal"><span class="pre">expected_url</span></code> doesn&#8217;t
include one (e.g. <code class="docutils literal"><span class="pre">&quot;/bar/&quot;</span></code>).  If <code class="docutils literal"><span class="pre">expected_url</span></code> is an absolute URL that
includes a host (e.g. <code class="docutils literal"><span class="pre">&quot;http://testhost/bar/&quot;</span></code>), the <code class="docutils literal"><span class="pre">host</span></code> parameter
will be ignored. Note that the test client doesn&#8217;t support fetching external
URLs, but the parameter may be useful if you are testing with a custom HTTP
host (for example, initializing the test client with
<code class="docutils literal"><span class="pre">Client(HTTP_HOST=&quot;testhost&quot;)</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">fetch_redirect_response</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, the final page won&#8217;t be
loaded. Since the test client can&#8217;t fetch externals URLs, this is
particularly useful if <code class="docutils literal"><span class="pre">expected_url</span></code> isn&#8217;t part of your Django app.</p>
<p>Scheme is handled correctly when making comparisons between two URLs. If
there isn&#8217;t any scheme specified in the location where we are redirected to,
the original request&#8217;s scheme is used. If present, the scheme in
<code class="docutils literal"><span class="pre">expected_url</span></code> is the one used to make the comparisons to.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertHTMLEqual">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertHTMLEqual</code><span class="sig-paren">(</span><em>html1</em>, <em>html2</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertHTMLEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the strings <code class="docutils literal"><span class="pre">html1</span></code> and <code class="docutils literal"><span class="pre">html2</span></code> are equal. The comparison
is based on HTML semantics. The comparison takes following things into
account:</p>
<ul class="simple">
<li>Whitespace before and after HTML tags is ignored.</li>
<li>All types of whitespace are considered equivalent.</li>
<li>All open tags are closed implicitly, e.g. when a surrounding tag is
closed or the HTML document ends.</li>
<li>Empty tags are equivalent to their self-closing version.</li>
<li>The ordering of attributes of an HTML element is not significant.</li>
<li>Attributes without an argument are equal to attributes that equal in
name and value (see the examples).</li>
</ul>
<p>The following examples are valid tests and don&#8217;t raise any
<code class="docutils literal"><span class="pre">AssertionError</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>self.assertHTMLEqual(&#39;&lt;p&gt;Hello &lt;b&gt;world!&lt;/p&gt;&#39;,
    &#39;&#39;&#39;&lt;p&gt;
        Hello   &lt;b&gt;world! &lt;b/&gt;
    &lt;/p&gt;&#39;&#39;&#39;)
self.assertHTMLEqual(
    &#39;&lt;input type=&quot;checkbox&quot; checked=&quot;checked&quot; id=&quot;id_accept_terms&quot; /&gt;&#39;,
    &#39;&lt;input id=&quot;id_accept_terms&quot; type=&#39;checkbox&#39; checked&gt;&#39;)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">html1</span></code> and <code class="docutils literal"><span class="pre">html2</span></code> must be valid HTML. An <code class="docutils literal"><span class="pre">AssertionError</span></code> will be
raised if one of them cannot be parsed.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertHTMLNotEqual">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertHTMLNotEqual</code><span class="sig-paren">(</span><em>html1</em>, <em>html2</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertHTMLNotEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the strings <code class="docutils literal"><span class="pre">html1</span></code> and <code class="docutils literal"><span class="pre">html2</span></code> are <em>not</em> equal. The
comparison is based on HTML semantics. See
<a class="reference internal" href="#SimpleTestCase.assertHTMLEqual" title="SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertHTMLEqual()</span></code></a> for details.</p>
<p><code class="docutils literal"><span class="pre">html1</span></code> and <code class="docutils literal"><span class="pre">html2</span></code> must be valid HTML. An <code class="docutils literal"><span class="pre">AssertionError</span></code> will be
raised if one of them cannot be parsed.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertXMLEqual">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertXMLEqual</code><span class="sig-paren">(</span><em>xml1</em>, <em>xml2</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertXMLEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the strings <code class="docutils literal"><span class="pre">xml1</span></code> and <code class="docutils literal"><span class="pre">xml2</span></code> are equal. The
comparison is based on XML semantics. Similarly to
<a class="reference internal" href="#SimpleTestCase.assertHTMLEqual" title="SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertHTMLEqual()</span></code></a>, the comparison is
made on parsed content, hence only semantic differences are considered, not
syntax differences. When invalid XML is passed in any parameter, an
<code class="docutils literal"><span class="pre">AssertionError</span></code> is always raised, even if both string are identical.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertXMLNotEqual">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertXMLNotEqual</code><span class="sig-paren">(</span><em>xml1</em>, <em>xml2</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertXMLNotEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the strings <code class="docutils literal"><span class="pre">xml1</span></code> and <code class="docutils literal"><span class="pre">xml2</span></code> are <em>not</em> equal. The
comparison is based on XML semantics. See
<a class="reference internal" href="#SimpleTestCase.assertXMLEqual" title="SimpleTestCase.assertXMLEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertXMLEqual()</span></code></a> for details.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertInHTML">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertInHTML</code><span class="sig-paren">(</span><em>needle</em>, <em>haystack</em>, <em>count=None</em>, <em>msg_prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertInHTML" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the HTML fragment <code class="docutils literal"><span class="pre">needle</span></code> is contained in the <code class="docutils literal"><span class="pre">haystack</span></code> one.</p>
<p>If the <code class="docutils literal"><span class="pre">count</span></code> integer argument is specified, then additionally the number
of <code class="docutils literal"><span class="pre">needle</span></code> occurrences will be strictly verified.</p>
<p>Whitespace in most cases is ignored, and attribute ordering is not
significant. The passed-in arguments must be valid HTML.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertJSONEqual">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertJSONEqual</code><span class="sig-paren">(</span><em>raw</em>, <em>expected_data</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertJSONEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the JSON fragments <code class="docutils literal"><span class="pre">raw</span></code> and <code class="docutils literal"><span class="pre">expected_data</span></code> are equal.
Usual JSON non-significant whitespace rules apply as the heavyweight is
delegated to the <code class="xref py py-mod docutils literal"><span class="pre">json</span></code> library.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="SimpleTestCase.assertJSONNotEqual">
<code class="descclassname">SimpleTestCase.</code><code class="descname">assertJSONNotEqual</code><span class="sig-paren">(</span><em>raw</em>, <em>expected_data</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SimpleTestCase.assertJSONNotEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that the JSON fragments <code class="docutils literal"><span class="pre">raw</span></code> and <code class="docutils literal"><span class="pre">expected_data</span></code> are <em>not</em> equal.
See <a class="reference internal" href="#SimpleTestCase.assertJSONEqual" title="SimpleTestCase.assertJSONEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertJSONEqual()</span></code></a> for further details.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="TransactionTestCase.assertQuerysetEqual">
<code class="descclassname">TransactionTestCase.</code><code class="descname">assertQuerysetEqual</code><span class="sig-paren">(</span><em>qs</em>, <em>values</em>, <em>transform=repr</em>, <em>ordered=True</em>, <em>msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#TransactionTestCase.assertQuerysetEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that a queryset <code class="docutils literal"><span class="pre">qs</span></code> returns a particular list of values <code class="docutils literal"><span class="pre">values</span></code>.</p>
<p>The comparison of the contents of <code class="docutils literal"><span class="pre">qs</span></code> and <code class="docutils literal"><span class="pre">values</span></code> is performed using
the function <code class="docutils literal"><span class="pre">transform</span></code>; by default, this means that the <code class="docutils literal"><span class="pre">repr()</span></code> of
each value is compared. Any other callable can be used if <code class="docutils literal"><span class="pre">repr()</span></code> doesn&#8217;t
provide a unique or helpful comparison.</p>
<p>By default, the comparison is also ordering dependent. If <code class="docutils literal"><span class="pre">qs</span></code> doesn&#8217;t
provide an implicit ordering, you can set the <code class="docutils literal"><span class="pre">ordered</span></code> parameter to
<code class="docutils literal"><span class="pre">False</span></code>, which turns the comparison into a <code class="docutils literal"><span class="pre">collections.Counter</span></code> comparison.
If the order is undefined (if the given <code class="docutils literal"><span class="pre">qs</span></code> isn&#8217;t ordered and the
comparison is against more than one ordered values), a <code class="docutils literal"><span class="pre">ValueError</span></code> is
raised.</p>
<p>Output in case of error can be customized with the <code class="docutils literal"><span class="pre">msg</span></code> argument.</p>
</dd></dl>

<dl class="method">
<dt id="TransactionTestCase.assertNumQueries">
<code class="descclassname">TransactionTestCase.</code><code class="descname">assertNumQueries</code><span class="sig-paren">(</span><em>num</em>, <em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#TransactionTestCase.assertNumQueries" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that when <code class="docutils literal"><span class="pre">func</span></code> is called with <code class="docutils literal"><span class="pre">*args</span></code> and <code class="docutils literal"><span class="pre">**kwargs</span></code> that
<code class="docutils literal"><span class="pre">num</span></code> database queries are executed.</p>
<p>If a <code class="docutils literal"><span class="pre">&quot;using&quot;</span></code> key is present in <code class="docutils literal"><span class="pre">kwargs</span></code> it is used as the database
alias for which to check the number of queries.  If you wish to call a
function with a <code class="docutils literal"><span class="pre">using</span></code> parameter you can do it by wrapping the call with
a <code class="docutils literal"><span class="pre">lambda</span></code> to add an extra parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">my_function</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
<p>You can also use this as a context manager:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Aaron&quot;</span><span class="p">)</span>
    <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Daniel&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="email-services">
<span id="topics-testing-email"></span><h3>Email services<a class="headerlink" href="#email-services" title="Permalink to this headline">¶</a></h3>
<p>If any of your Django views send email using Django&#8217;s email
functionality, you probably don&#8217;t want to send email each time
you run a test using that view. For this reason, Django&#8217;s test runner
automatically redirects all Django-sent email to a dummy outbox. This lets you
test every aspect of sending email &#8211; from the number of messages sent to the
contents of each message &#8211; without actually sending the messages.</p>
<p>The test runner accomplishes this by transparently replacing the normal
email backend with a testing backend.
(Don&#8217;t worry &#8211; this has no effect on any other email senders outside of
Django, such as your machine&#8217;s mail server, if you&#8217;re running one.)</p>
<dl class="data">
<dt id="django.core.mail.django.core.mail.outbox">
<code class="descclassname">django.core.mail.</code><code class="descname">outbox</code><a class="headerlink" href="#django.core.mail.django.core.mail.outbox" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>During test running, each outgoing email is saved in
<code class="docutils literal"><span class="pre">django.core.mail.outbox</span></code>. This is a simple list of all
<code class="xref py py-class docutils literal"><span class="pre">EmailMessage</span></code> instances that have been sent.
The <code class="docutils literal"><span class="pre">outbox</span></code> attribute is a special attribute that is created <em>only</em> when
the <code class="docutils literal"><span class="pre">locmem</span></code> email backend is used. It doesn&#8217;t normally exist as part of the
<code class="xref py py-mod docutils literal"><span class="pre">django.core.mail</span></code> module and you can&#8217;t import it directly. The code
below shows how to access this attribute correctly.</p>
<p>Here&#8217;s an example test that examines <code class="docutils literal"><span class="pre">django.core.mail.outbox</span></code> for length
and contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">EmailTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_send_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Send message.</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">send_mail</span><span class="p">(</span><span class="s">&#39;Subject here&#39;</span><span class="p">,</span> <span class="s">&#39;Here is the message.&#39;</span><span class="p">,</span>
            <span class="s">&#39;from@example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;to@example.com&#39;</span><span class="p">],</span>
            <span class="n">fail_silently</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># Test that one message has been sent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Verify that the subject of the first message is correct.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;Subject here&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As noted previously, the test outbox is emptied
at the start of every test in a Django <code class="docutils literal"><span class="pre">*TestCase</span></code>. To empty the outbox
manually, assign the empty list to <code class="docutils literal"><span class="pre">mail.outbox</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">mail</span>

<span class="c"># Empty the test outbox</span>
<span class="n">mail</span><span class="o">.</span><span class="n">outbox</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
<div class="section" id="management-commands">
<span id="topics-testing-management-commands"></span><h3>Management Commands<a class="headerlink" href="#management-commands" title="Permalink to this headline">¶</a></h3>
<p>Management commands can be tested with the
<a class="reference internal" href="appendix_F.html#django.core.management.call_command" title="django.core.management.call_command"><code class="xref py py-func docutils literal"><span class="pre">call_command()</span></code></a> function. The output can be
redirected into a <code class="docutils literal"><span class="pre">StringIO</span></code> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">call_command</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.utils.six</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="k">class</span> <span class="nc">ClosepollTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_command_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">call_command</span><span class="p">(</span><span class="s">&#39;closepoll&#39;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;Expected output&#39;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="skipping-tests">
<span id="id5"></span><h3>Skipping tests<a class="headerlink" href="#skipping-tests" title="Permalink to this headline">¶</a></h3>
<p>The unittest library provides the <code class="xref py py-func docutils literal"><span class="pre">&#64;skipIf</span></code> and
<code class="xref py py-func docutils literal"><span class="pre">&#64;skipUnless</span></code> decorators to allow you to skip tests
if you know ahead of time that those tests are going to fail under certain
conditions.</p>
<p>For example, if your test requires a particular optional library in order to
succeed, you could decorate the test case with <code class="xref py py-func docutils literal"><span class="pre">&#64;skipIf</span></code>. Then, the test runner will report that the test wasn&#8217;t
executed and why, instead of failing the test or omitting the test altogether.</p>
<p>To supplement these test skipping behaviors, Django provides two
additional skip decorators. Instead of testing a generic boolean,
these decorators check the capabilities of the database, and skip the
test if the database doesn&#8217;t support a specific named feature.</p>
<p>The decorators use a string identifier to describe database features.
This string corresponds to attributes of the database connection
features class. See <code class="docutils literal"><span class="pre">django.db.backends.BaseDatabaseFeatures</span></code>
class for a full list of database features that can be used as a basis
for skipping tests.</p>
<dl class="function">
<dt id="django.test.skipIfDBFeature">
<code class="descclassname">django.test.</code><code class="descname">skipIfDBFeature</code><span class="sig-paren">(</span><em>*feature_name_strings</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.skipIfDBFeature" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Skip the decorated test or <code class="docutils literal"><span class="pre">TestCase</span></code> if all of the named database features
are supported.</p>
<p>For example, the following test will not be executed if the database
supports transactions (e.g., it would <em>not</em> run under PostgreSQL, but
it would under MySQL with MyISAM tables):</p>
<div class="highlight-python"><div class="highlight"><pre>class MyTests(TestCase):
    @skipIfDBFeature(&#39;supports_transactions&#39;)
    def test_transaction_behavior(self):
        # ... conditional test code

``skipIfDBFeature`` can accept multiple feature strings.
</pre></div>
</div>
<dl class="function">
<dt id="django.test.skipUnlessDBFeature">
<code class="descclassname">django.test.</code><code class="descname">skipUnlessDBFeature</code><span class="sig-paren">(</span><em>*feature_name_strings</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.skipUnlessDBFeature" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Skip the decorated test or <code class="docutils literal"><span class="pre">TestCase</span></code> if any of the named database features
are <em>not</em> supported.</p>
<p>For example, the following test will only be executed if the database
supports transactions (e.g., it would run under PostgreSQL, but <em>not</em>
under MySQL with MyISAM tables):</p>
<div class="highlight-python"><div class="highlight"><pre>class MyTests(TestCase):
    @skipUnlessDBFeature(&#39;supports_transactions&#39;)
    def test_transaction_behavior(self):
        # ... conditional test code

``skipUnlessDBFeature`` can accept multiple feature strings.
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-the-django-test-runner-to-test-reusable-applications">
<h2>Using the Django test runner to test reusable applications<a class="headerlink" href="#using-the-django-test-runner-to-test-reusable-applications" title="Permalink to this headline">¶</a></h2>
<p>If you are writing a reusable application
you may want to use the Django test runner to run your own test suite
and thus benefit from the Django testing infrastructure.</p>
<p>A common practice is a <em>tests</em> directory next to the application code, with the
following structure:</p>
<div class="highlight-python"><div class="highlight"><pre>runtests.py
polls/
    __init__.py
    models.py
    ...
tests/
    __init__.py
    models.py
    test_settings.py
    tests.py
</pre></div>
</div>
<p>Let&#8217;s take a look inside a couple of those files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># runtests.py</span>

<span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">django</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">get_runner</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tests.test_settings&#39;</span>
    <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    <span class="n">TestRunner</span> <span class="o">=</span> <span class="n">get_runner</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">test_runner</span> <span class="o">=</span> <span class="n">TestRunner</span><span class="p">()</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="n">test_runner</span><span class="o">.</span><span class="n">run_tests</span><span class="p">([</span><span class="s">&quot;tests&quot;</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">failures</span><span class="p">))</span>
</pre></div>
</div>
<p>This is the script that you invoke to run the test suite. It sets up the
Django environment, creates the test database and runs the tests.</p>
<p>For the sake of clarity, this example contains only the bare minimum
necessary to use the Django test runner. You may want to add
command-line options for controlling verbosity, passing in specific test
labels to run, etc.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># tests/test_settings.py</span>

 <span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#39;fake-key&#39;</span>
 <span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
     <span class="s">&quot;tests&quot;</span><span class="p">,</span>
 <span class="p">]</span>
</pre></div>
</div>
<p>This file contains the Django settings
required to run your app&#8217;s tests.</p>
<p>Again, this is a minimal example; your tests may require additional
settings to run.</p>
<p>Since the <em>tests</em> package is included in <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> when
running your tests, you can define test-only models in its <code class="docutils literal"><span class="pre">models.py</span></code>
file.</p>
</div>
<div class="section" id="using-different-testing-frameworks">
<span id="other-testing-frameworks"></span><h2>Using different testing frameworks<a class="headerlink" href="#using-different-testing-frameworks" title="Permalink to this headline">¶</a></h2>
<p>Clearly, <code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code> is not the only Python testing framework. While Django
doesn&#8217;t provide explicit support for alternative frameworks, it does provide a
way to invoke tests constructed for an alternative framework as if they were
normal Django tests.</p>
<p>When you run <code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code>, Django looks at the <code class="docutils literal"><span class="pre">TEST_RUNNER</span></code>
setting to determine what to do. By default,````TEST_RUNNER`` points to
<code class="docutils literal"><span class="pre">'django.test.runner.DiscoverRunner'</span></code>. This class defines the default Django
testing behavior. This behavior involves:</p>
<ol class="arabic simple">
<li>Performing global pre-test setup.</li>
<li>Looking for tests in any file below the current directory whose name matches
the pattern <code class="docutils literal"><span class="pre">test*.py</span></code>.</li>
<li>Creating the test databases.</li>
<li>Running <code class="docutils literal"><span class="pre">migrate</span></code> to install models and initial data into the test
databases.</li>
<li>Running the tests that were found.</li>
<li>Destroying the test databases.</li>
<li>Performing global post-test teardown.</li>
</ol>
<p>If you define your own test runner class and point <code class="docutils literal"><span class="pre">TEST_RUNNER</span></code> at
that class, Django will execute your test runner whenever you run
<code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code>. In this way, it is possible to use any test framework
that can be executed from Python code, or to modify the Django test execution
process to satisfy whatever testing requirements you may have.</p>
<div class="section" id="defining-a-test-runner">
<span id="topics-testing-test-runner"></span><h3>Defining a test runner<a class="headerlink" href="#defining-a-test-runner" title="Permalink to this headline">¶</a></h3>
<p>A test runner is a class defining a <code class="docutils literal"><span class="pre">run_tests()</span></code> method. Django ships
with a <code class="docutils literal"><span class="pre">DiscoverRunner</span></code> class that defines the default Django testing
behavior. This class defines the <code class="docutils literal"><span class="pre">run_tests()</span></code> entry point, plus a
selection of other methods that are used to by <code class="docutils literal"><span class="pre">run_tests()</span></code> to set up,
execute and tear down the test suite.</p>
<dl class="class">
<dt id="django.test.runner.DiscoverRunner">
<em class="property">class </em><code class="descclassname">django.test.runner.</code><code class="descname">DiscoverRunner</code><span class="sig-paren">(</span><em>pattern='test*.py'</em>, <em>top_level=None</em>, <em>verbosity=1</em>, <em>interactive=True</em>, <em>failfast=True</em>, <em>keepdb=False</em>, <em>reverse=False</em>, <em>debug_sql=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">DiscoverRunner</span></code> will search for tests in any file matching <code class="docutils literal"><span class="pre">pattern</span></code>.</p>
<p><code class="docutils literal"><span class="pre">top_level</span></code> can be used to specify the directory containing your
top-level Python modules. Usually Django can figure this out automatically,
so it&#8217;s not necessary to specify this option. If specified, it should
generally be the directory containing your <code class="docutils literal"><span class="pre">manage.py</span></code> file.</p>
<p><code class="docutils literal"><span class="pre">verbosity</span></code> determines the amount of notification and debug information
that will be printed to the console; <code class="docutils literal"><span class="pre">0</span></code> is no output, <code class="docutils literal"><span class="pre">1</span></code> is normal
output, and <code class="docutils literal"><span class="pre">2</span></code> is verbose output.</p>
<p>If <code class="docutils literal"><span class="pre">interactive</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, the test suite has permission to ask the
user for instructions when the test suite is executed. An example of this
behavior would be asking for permission to delete an existing test
database. If <code class="docutils literal"><span class="pre">interactive</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, the test suite must be able to
run without any manual intervention.</p>
<p>If <code class="docutils literal"><span class="pre">failfast</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, the test suite will stop running after the
first test failure is detected.</p>
<p>If <code class="docutils literal"><span class="pre">keepdb</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, the test suite will use the existing database,
or create one if necessary. If <code class="docutils literal"><span class="pre">False</span></code>, a new database will be created,
prompting the user to remove the existing one, if present.</p>
<p>If <code class="docutils literal"><span class="pre">reverse</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, test cases will be executed in the opposite
order. This could be useful to debug tests that aren&#8217;t properly isolated
and have side effects. Grouping by test class is
preserved when using this option.</p>
<p>If <code class="docutils literal"><span class="pre">debug_sql</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, failing test cases will output SQL queries
logged to the django.db.backends logger as well
as the traceback. If <code class="docutils literal"><span class="pre">verbosity</span></code> is <code class="docutils literal"><span class="pre">2</span></code>, then queries in all tests are
output.</p>
<p>Django may, from time to time, extend the capabilities of the test runner
by adding new arguments. The <code class="docutils literal"><span class="pre">**kwargs</span></code> declaration allows for this
expansion. If you subclass <code class="docutils literal"><span class="pre">DiscoverRunner</span></code> or write your own test
runner, ensure it accepts <code class="docutils literal"><span class="pre">**kwargs</span></code>.</p>
<p>Your test runner may also define additional command-line options.
Create or override an <code class="docutils literal"><span class="pre">add_arguments(cls,</span> <span class="pre">parser)</span></code> class method and add
custom arguments by calling <code class="docutils literal"><span class="pre">parser.add_argument()</span></code> inside the method, so
that the <code class="docutils literal"><span class="pre">test</span></code> command will be able to use those arguments.</p>
</dd></dl>

<div class="section" id="attributes">
<h4>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="django.test.runner.DiscoverRunner.test_suite">
<code class="descclassname">DiscoverRunner.</code><code class="descname">test_suite</code><a class="headerlink" href="#django.test.runner.DiscoverRunner.test_suite" title="Permalink to this definition">¶</a></dt>
<dd><p>The class used to build the test suite. By default it is set to
<code class="docutils literal"><span class="pre">unittest.TestSuite</span></code>. This can be overridden if you wish to implement
different logic for collecting tests.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.test.runner.DiscoverRunner.test_runner">
<code class="descclassname">DiscoverRunner.</code><code class="descname">test_runner</code><a class="headerlink" href="#django.test.runner.DiscoverRunner.test_runner" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the class of the low-level test runner which is used to execute
the individual tests and format the results. By default it is set to
<code class="docutils literal"><span class="pre">unittest.TextTestRunner</span></code>. Despite the unfortunate similarity in
naming conventions, this is not the same type of class as
<code class="docutils literal"><span class="pre">DiscoverRunner</span></code>, which covers a broader set of responsibilities. You
can override this attribute to modify the way tests are run and reported.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.test.runner.DiscoverRunner.test_loader">
<code class="descclassname">DiscoverRunner.</code><code class="descname">test_loader</code><a class="headerlink" href="#django.test.runner.DiscoverRunner.test_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the class that loads tests, whether from TestCases or modules or
otherwise and bundles them into test suites for the runner to execute.
By default it is set to <code class="docutils literal"><span class="pre">unittest.defaultTestLoader</span></code>. You can override
this attribute if your tests are going to be loaded in unusual ways.</p>
</dd></dl>

</div>
<div class="section" id="methods">
<h4>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.test.runner.DiscoverRunner.run_tests">
<code class="descclassname">DiscoverRunner.</code><code class="descname">run_tests</code><span class="sig-paren">(</span><em>test_labels</em>, <em>extra_tests=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.run_tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the test suite.</p>
<p><code class="docutils literal"><span class="pre">test_labels</span></code> allows you to specify which tests to run and supports
several formats (see <a class="reference internal" href="#django.test.runner.DiscoverRunner.build_suite" title="django.test.runner.DiscoverRunner.build_suite"><code class="xref py py-meth docutils literal"><span class="pre">DiscoverRunner.build_suite()</span></code></a> for a list of
supported formats).</p>
<p><code class="docutils literal"><span class="pre">extra_tests</span></code> is a list of extra <code class="docutils literal"><span class="pre">TestCase</span></code> instances to add to the
suite that is executed by the test runner. These extra tests are run
in addition to those discovered in the modules listed in <code class="docutils literal"><span class="pre">test_labels</span></code>.</p>
<p>This method should return the number of tests that failed.</p>
</dd></dl>

<dl class="classmethod">
<dt id="django.test.runner.DiscoverRunner.add_arguments">
<em class="property">classmethod </em><code class="descclassname">DiscoverRunner.</code><code class="descname">add_arguments</code><span class="sig-paren">(</span><em>parser</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.add_arguments" title="Permalink to this definition">¶</a></dt>
<dd><p>Override this class method to add custom arguments accepted by the
<code class="docutils literal"><span class="pre">test</span></code> management command. See
<code class="xref py py-meth docutils literal"><span class="pre">argparse.ArgumentParser.add_argument()</span></code> for details about adding
arguments to a parser.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.setup_test_environment">
<code class="descclassname">DiscoverRunner.</code><code class="descname">setup_test_environment</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.setup_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets up the test environment by calling
<a class="reference internal" href="#django.test.utils.setup_test_environment" title="django.test.utils.setup_test_environment"><code class="xref py py-func docutils literal"><span class="pre">setup_test_environment()</span></code></a> and setting
<code class="docutils literal"><span class="pre">DEBUG</span></code> to <code class="docutils literal"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.build_suite">
<code class="descclassname">DiscoverRunner.</code><code class="descname">build_suite</code><span class="sig-paren">(</span><em>test_labels</em>, <em>extra_tests=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.build_suite" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs a test suite that matches the test labels provided.</p>
<p><code class="docutils literal"><span class="pre">test_labels</span></code> is a list of strings describing the tests to be run. A test
label can take one of four forms:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">path.to.test_module.TestCase.test_method</span></code> &#8211; Run a single test method
in a test case.</li>
<li><code class="docutils literal"><span class="pre">path.to.test_module.TestCase</span></code> &#8211; Run all the test methods in a test
case.</li>
<li><code class="docutils literal"><span class="pre">path.to.module</span></code> &#8211; Search for and run all tests in the named Python
package or module.</li>
<li><code class="docutils literal"><span class="pre">path/to/directory</span></code> &#8211; Search for and run all tests below the named
directory.</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">test_labels</span></code> has a value of <code class="docutils literal"><span class="pre">None</span></code>, the test runner will search for
tests in all files below the current directory whose names match its
<code class="docutils literal"><span class="pre">pattern</span></code> (see above).</p>
<p><code class="docutils literal"><span class="pre">extra_tests</span></code> is a list of extra <code class="docutils literal"><span class="pre">TestCase</span></code> instances to add to the
suite that is executed by the test runner. These extra tests are run
in addition to those discovered in the modules listed in <code class="docutils literal"><span class="pre">test_labels</span></code>.</p>
<p>Returns a <code class="docutils literal"><span class="pre">TestSuite</span></code> instance ready to be run.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.setup_databases">
<code class="descclassname">DiscoverRunner.</code><code class="descname">setup_databases</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.setup_databases" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the test databases.</p>
<p>Returns a data structure that provides enough detail to undo the changes
that have been made. This data will be provided to the <code class="docutils literal"><span class="pre">teardown_databases()</span></code>
function at the conclusion of testing.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.run_suite">
<code class="descclassname">DiscoverRunner.</code><code class="descname">run_suite</code><span class="sig-paren">(</span><em>suite</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.run_suite" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the test suite.</p>
<p>Returns the result produced by the running the test suite.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.teardown_databases">
<code class="descclassname">DiscoverRunner.</code><code class="descname">teardown_databases</code><span class="sig-paren">(</span><em>old_config</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.teardown_databases" title="Permalink to this definition">¶</a></dt>
<dd><p>Destroys the test databases, restoring pre-test conditions.</p>
<p><code class="docutils literal"><span class="pre">old_config</span></code> is a data structure defining the changes in the
database configuration that need to be reversed. It is the return
value of the <code class="docutils literal"><span class="pre">setup_databases()</span></code> method.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.teardown_test_environment">
<code class="descclassname">DiscoverRunner.</code><code class="descname">teardown_test_environment</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.teardown_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Restores the pre-test environment.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.runner.DiscoverRunner.suite_result">
<code class="descclassname">DiscoverRunner.</code><code class="descname">suite_result</code><span class="sig-paren">(</span><em>suite</em>, <em>result</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.runner.DiscoverRunner.suite_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes and returns a return code based on a test suite, and the result
from that test suite.</p>
</dd></dl>

</div>
</div>
<div class="section" id="testing-utilities">
<h3>Testing utilities<a class="headerlink" href="#testing-utilities" title="Permalink to this headline">¶</a></h3>
<div class="section" id="module-django.test.utils">
<span id="django-test-utils"></span><h4>django.test.utils<a class="headerlink" href="#module-django.test.utils" title="Permalink to this headline">¶</a></h4>
<p>To assist in the creation of your own test runner, Django provides a number of
utility methods in the <code class="docutils literal"><span class="pre">django.test.utils</span></code> module.</p>
<dl class="function">
<dt id="django.test.utils.setup_test_environment">
<code class="descclassname">django.test.utils.</code><code class="descname">setup_test_environment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django.test.utils.setup_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs any global pre-test setup, such as the installing the
instrumentation of the template rendering system and setting up
the dummy email outbox.</p>
</dd></dl>

<dl class="function">
<dt id="django.test.utils.teardown_test_environment">
<code class="descclassname">django.test.utils.</code><code class="descname">teardown_test_environment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django.test.utils.teardown_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs any global post-test teardown, such as removing the black
magic hooks into the template system and restoring normal email
services.</p>
</dd></dl>

</div>
<div class="section" id="django-db-connection-creation">
<h4>django.db.connection.creation<a class="headerlink" href="#django-db-connection-creation" title="Permalink to this headline">¶</a></h4>
<p>The creation module of the database backend also provides some utilities that
can be useful during testing.</p>
<dl class="function">
<dt id="django.db.connection.creation.create_test_db">
<code class="descclassname">django.db.connection.creation.</code><code class="descname">create_test_db</code><span class="sig-paren">(</span><span class="optional">[</span><em>verbosity=1</em>, <em>autoclobber=False</em>, <em>serialize=True</em>, <em>keepdb=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#django.db.connection.creation.create_test_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new test database and runs <code class="docutils literal"><span class="pre">migrate</span></code> against it.</p>
<p><code class="docutils literal"><span class="pre">verbosity</span></code> has the same behavior as in <code class="docutils literal"><span class="pre">run_tests()</span></code>.</p>
<p><code class="docutils literal"><span class="pre">autoclobber</span></code> describes the behavior that will occur if a
database with the same name as the test database is discovered:</p>
<ul class="simple">
<li>If <code class="docutils literal"><span class="pre">autoclobber</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, the user will be asked to
approve destroying the existing database. <code class="docutils literal"><span class="pre">sys.exit</span></code> is
called if the user does not approve.</li>
<li>If autoclobber is <code class="docutils literal"><span class="pre">True</span></code>, the database will be destroyed
without consulting the user.</li>
</ul>
<p><code class="docutils literal"><span class="pre">serialize</span></code> determines if Django serializes the database into an
in-memory JSON string before running tests (used to restore the database
state between tests if you don&#8217;t have transactions). You can set this to
<code class="docutils literal"><span class="pre">False</span></code> to speed up creation time if you don&#8217;t have any test classes
with serialized_rollback=True.</p>
<p>If you are using the default test runner, you can control this with the
the <code class="docutils literal"><span class="pre">SERIALIZE</span> <span class="pre">&lt;TEST_SERIALIZE&gt;</span></code> entry in the <code class="docutils literal"><span class="pre">TEST</span></code></p>
<p><code class="docutils literal"><span class="pre">keepdb</span></code> determines if the test run should use an existing
database, or create a new one. If <code class="docutils literal"><span class="pre">True</span></code>, the existing
database will be used, or created if not present. If <code class="docutils literal"><span class="pre">False</span></code>,
a new database will be created, prompting the user to remove
the existing one, if present.</p>
<p>Returns the name of the test database that it created.</p>
<p><code class="docutils literal"><span class="pre">create_test_db()</span></code> has the side effect of modifying the value of
<code class="docutils literal"><span class="pre">NAME</span></code> in <code class="docutils literal"><span class="pre">DATABASES</span></code> to match the name of the test
database.</p>
</dd></dl>

<dl class="function">
<dt id="django.db.connection.creation.destroy_test_db">
<code class="descclassname">django.db.connection.creation.</code><code class="descname">destroy_test_db</code><span class="sig-paren">(</span><em>old_database_name</em><span class="optional">[</span>, <em>verbosity=1</em>, <em>keepdb=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#django.db.connection.creation.destroy_test_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Destroys the database whose name is the value of <code class="docutils literal"><span class="pre">NAME</span></code> in
<code class="docutils literal"><span class="pre">DATABASES</span></code>, and sets <code class="docutils literal"><span class="pre">NAME</span></code> to the value of
<code class="docutils literal"><span class="pre">old_database_name</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">verbosity</span></code> argument has the same behavior as for
<a class="reference internal" href="#django.test.runner.DiscoverRunner" title="django.test.runner.DiscoverRunner"><code class="xref py py-class docutils literal"><span class="pre">DiscoverRunner</span></code></a>.</p>
<p>If the <code class="docutils literal"><span class="pre">keepdb</span></code> argument is <code class="docutils literal"><span class="pre">True</span></code>, then the connection to the
database will be closed, but the database will not be destroyed.</p>
</dd></dl>

</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="front_matter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction_django.html">Introduction to Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_01.html">Chapter 1: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_02.html">Chapter 2: Views and URLconfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_03.html">Chapter 3: Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_04.html">Chapter 4: Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_05.html">Chapter 5: The Django Admin Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_06.html">Chapter 6: Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_07.html">Chapter 7: Advanced Views and URLconfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_08.html">Chapter 8: Advanced Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_09.html">Chapter 9: Advanced Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_10.html">Chapter 10: Generic Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_11.html">Chapter 11: User authentication in Django</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Chapter 12 - testing in Django</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introducing-automated-testing">Introducing automated testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-testing-strategies">Basic testing strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-tests">Writing tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-tools">Testing tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-django-test-runner-to-test-reusable-applications">Using the Django test runner to test reusable applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-different-testing-frameworks">Using different testing frameworks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="chapter_13.html">Chapter 13: Deploying Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_14.html">Chapter 14 - How to write reusable apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_15.html">Chapter 15: Generating Non-HTML Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_16.html">Chapter 16 - Django sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_17.html">Chapter 17 - Django&#8217;s cache framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_18.html">Chapter 18 - Other core Django functionalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_19.html">Chapter 19 - Django Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_20.html">Chapter 20: Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_21.html">Chapter 21: Security in Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_A.html">Appendix A: Model Definition Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_B.html">Appendix B: Database API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_C.html">Appendix C: Generic View Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_D.html">Appendix D: Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_E.html">Appendix E: Built-in Template Tags and Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_F.html">Appendix F: The django-admin Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_G.html">Appendix G: Request and Response Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License &amp; Copyright</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="chapter_11.html" title="Chapter 11: User authentication in Django"
              >previous</a> |
            <a href="chapter_13.html" title="Chapter 13: Deploying Django"
              >next</a> |
            <a href="py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/chapter_12.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Nigel George.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>